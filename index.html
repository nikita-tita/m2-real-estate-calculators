<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>М2 — Платформа калькуляторов недвижимости</title>
    <meta name="description" content="Комплексная платформа калькуляторов для недвижимости: ипотека, доступность жилья, инвестиции, аренда vs покупка. Точные расчеты с экспортом в PDF.">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="М2 Калькуляторы">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#007bff">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- М2 Components -->
    <script src="components.js"></script>
    
    <!-- Favicons and Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="icons/icon-114x114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icons/icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icons/icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="icons/icon-57x57.png">
    
    <!-- Scripts -->
    <script src="tooltip-system.js"></script>
    <script src="calculator-storage.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.5;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 20px 0;
            text-align: center;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 48px;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 12px;
        }

        .title {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            text-align: center;
            margin-bottom: 16px;
        }

        .section-subtitle {
            font-size: 16px;
            color: #666;
            text-align: center;
            margin-bottom: 48px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .calculators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 60px;
        }

        .calculator-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
            position: relative;
        }

        .calculator-card:hover {
            text-decoration: none;
            color: inherit;
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: #007bff;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 16px;
            font-size: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
        }

        .card-badge {
            display: inline-block;
            background: #e8f4fd;
            color: #007bff;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .card-features {
            list-style: none;
            margin-bottom: 24px;
        }

        .card-features li {
            font-size: 13px;
            color: #555;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            line-height: 1.4;
        }

        .card-features li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        .card-action {
            display: inline-flex;
            align-items: center;
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .card-action:hover {
            background: #0056b3;
        }

        .card-action::after {
            content: '→';
            transition: transform 0.2s ease;
        }

        .calculator-card:hover .card-action::after {
            transform: translateX(4px);
        }

        .features-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-top: 40px;
        }

        .feature-item {
            text-align: center;
        }

        .feature-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #28a745, #20c997);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin: 0 auto 20px;
        }

        .feature-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
        }

        .feature-text {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 40px 0;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer p {
            color: #bdc3c7;
            font-size: 14px;
        }

        @media (max-width: 1024px) {
            .container {
                padding: 32px 16px;
            }
            
            .calculators-grid {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 24px 16px;
            }

            .header {
                padding: 16px 0;
            }

            .logo {
                font-size: 32px;
            }

            .title {
                font-size: 22px;
                margin-bottom: 8px;
            }

            .subtitle {
                font-size: 15px;
            }

            .section-title {
                font-size: 24px;
                margin-bottom: 12px;
            }

            .section-subtitle {
                font-size: 15px;
                margin-bottom: 32px;
            }

            .calculators-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-bottom: 40px;
            }

            .calculator-card {
                padding: 20px;
                border-radius: 12px;
            }

            .card-title {
                font-size: 18px;
            }

            .card-description {
                font-size: 14px;
                margin-bottom: 16px;
            }

            .features-section {
                padding: 32px 20px;
                border-radius: 12px;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 24px;
                margin-top: 24px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px 12px;
            }

            .header-content {
                padding: 0 12px;
            }

            .logo {
                font-size: 28px;
            }

            .title {
                font-size: 20px;
                line-height: 1.3;
            }

            .subtitle {
                font-size: 14px;
                line-height: 1.4;
            }

            .calculator-card {
                padding: 16px;
            }

            .card-icon {
                width: 40px;
                height: 40px;
                font-size: 16px;
                margin-right: 12px;
            }

            .card-title {
                font-size: 16px;
            }

            .card-description {
                font-size: 13px;
                line-height: 1.5;
            }

            .card-features li {
                font-size: 12px;
            }

            .features-section {
                padding: 24px 16px;
            }

            .feature-icon {
                width: 48px;
                height: 48px;
                font-size: 18px;
                margin-bottom: 16px;
            }

            .feature-title {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .feature-text {
                font-size: 13px;
            }
        }

        @media (max-width: 360px) {
            .container {
                padding: 16px 8px;
            }

            .header-content {
                padding: 0 8px;
            }

            .calculator-card {
                padding: 14px;
            }

            .features-section {
                padding: 20px 12px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">М2</div>
            <h1 class="title">Калькуляторы недвижимости</h1>
            <p class="subtitle">Быстрые расчеты ипотеки, доходности и доступности жилья. Введите данные → получите результат</p>
        </div>
    </header>

    <div class="container">
        <h2 class="section-title">Калькуляторы</h2>
        <p class="section-subtitle">
            Нажмите на калькулятор, введите свои данные и получите точный расчет
        </p>

        <div class="calculators-grid">
            <a href="mortgage_calculator.html" class="calculator-card">
                <div class="card-header">
                    <div class="card-icon">₽</div>
                    <div>
                        <h3 class="card-title">Ипотечный калькулятор</h3>
                        <span class="card-badge">Популярный</span>
                    </div>
                </div>
                <p class="card-description">
                    Введите: сумму кредита, ставку, срок. Получите: ежемесячный платеж, переплату, график платежей.
                </p>
                <ul class="card-features">
                    <li>Базовый режим: платеж, переплата, общая сумма</li>
                    <li>Расширенный: график погашения, досрочные платежи</li>
                    <li>Экспорт детального отчета в PDF</li>
                    <li>Валидация и проверка корректности данных</li>
                </ul>
                <div class="card-action">
                    Рассчитать ипотеку
                </div>
            </a>

            <a href="affordability_calculator.html" class="calculator-card">
                <div class="card-header">
                    <div class="card-icon">%</div>
                    <div>
                        <h3 class="card-title">Доступность жилья</h3>
                        <span class="card-badge">По доходу</span>
                    </div>
                </div>
                <p class="card-description">
                    Введите: доход, первоначальный взнос, обязательства. Получите: максимальную сумму кредита и стоимость доступного жилья.
                </p>
                <ul class="card-features">
                    <li>Расчет максимального платежа по доходу</li>
                    <li>Учет коэффициента долговой нагрузки (ПДН)</li>
                    <li>Обратный расчет: доход для желаемой суммы</li>
                    <li>Рекомендации по оптимизации параметров</li>
                </ul>
                <div class="card-action">
                    Рассчитать доступность
                </div>
            </a>

            <a href="rental_profitability_calculator.html" class="calculator-card">
                <div class="card-header">
                    <div class="card-icon">$</div>
                    <div>
                        <h3 class="card-title">Доходность недвижимости</h3>
                        <span class="card-badge">Универсальный</span>
                    </div>
                </div>
                <p class="card-description">
                    Введите: стоимость, арендную плату, расходы. Выберите: наличные или ипотека. Получите: полный анализ доходности инвестиций.
                </p>
                <ul class="card-features">
                    <li>Режимы покупки: за наличные и в ипотеку</li>
                    <li>Валовая и чистая доходность с учетом всех расходов</li>
                    <li>Базовый режим с слайдерами + расширенный анализ</li>
                    <li>Детализированный денежный поток и экспорт в PDF</li>
                </ul>
                <div class="card-action">
                    Рассчитать доходность
                </div>
            </a>

            <a href="rent_vs_buy_calculator.html" class="calculator-card">
                <div class="card-header">
                    <div class="card-icon">VS</div>
                    <div>
                        <h3 class="card-title">Аренда vs Покупка</h3>
                        <span class="card-badge">Сравнение</span>
                    </div>
                </div>
                <p class="card-description">
                    Введите: стоимость жилья, аренду, параметры ипотеки. Получите: что выгоднее на выбранный период и когда окупится покупка.
                </p>
                <ul class="card-features">
                    <li>Сравнение затрат за заданный период</li>
                    <li>Расчет точки безубыточности (break-even)</li>
                    <li>Учет роста цен и арендных ставок</li>
                    <li>Моделирование инвестирования разницы</li>
                </ul>
                <div class="card-action">
                    Сравнить варианты
                </div>
            </a>

            <a href="airbnb_calculator.html" class="calculator-card">
                <div class="card-header">
                    <div class="card-icon">🏠</div>
                    <div>
                        <h3 class="card-title">Краткосрочная аренда</h3>
                        <span class="card-badge">Airbnb</span>
                    </div>
                </div>
                <p class="card-description">
                    Введите: ставку за сутки, загруженность, расходы. Получите: доходность Airbnb, сравнение с долгосрочной арендой, сезонный анализ.
                </p>
                <ul class="card-features">
                    <li>Расчет доходности посуточной аренды</li>
                    <li>Учет комиссий платформ и операционных расходов</li>
                    <li>Сравнение с обычной долгосрочной арендой</li>
                    <li>Сезонный анализ доходности по месяцам</li>
                </ul>
                <div class="card-action">
                    Рассчитать Airbnb
                </div>
            </a>

            <a href="new_vs_secondary_calculator.html" class="calculator-card">
                <div class="card-header">
                    <div class="card-icon">🆚</div>
                    <div>
                        <h3 class="card-title">Новостройка vs Вторичка</h3>
                        <span class="card-badge">Сравнение</span>
                    </div>
                </div>
                <p class="card-description">
                    Введите: цены, сроки, расходы. Получите: полную стоимость владения, преимущества каждого варианта, персональную рекомендацию.
                </p>
                <ul class="card-features">
                    <li>Учет всех скрытых расходов и временных затрат</li>
                    <li>Анализ роста стоимости в процессе строительства</li>
                    <li>Детальное сравнение плюсов и минусов</li>
                    <li>Персональная рекомендация на основе расчетов</li>
                </ul>
                <div class="card-action">
                    Сравнить варианты
                </div>
            </a>

            <a href="https://m2.ru/ipoteka/calculator/" target="_blank" class="calculator-card">
                <div class="card-header">
                    <div class="card-icon">M2</div>
                    <div>
                        <h3 class="card-title">Ипотечный калькулятор M2</h3>
                        <span class="card-badge">Интеграция</span>
                    </div>
                </div>
                <p class="card-description">
                    Калькулятор от M2.ru — актуальные ставки всех банков. Подбор лучших предложений, мгновенная онлайн-заявка в банк.
                </p>
                <ul class="card-features">
                    <li>Актуальные ставки всех банков</li>
                    <li>Подбор оптимальных программ</li>
                    <li>Онлайн-заявка в банки</li>
                    <li>Персональные предложения</li>
                </ul>
                <div class="card-action">
                    Перейти на M2
                </div>
            </a>
        </div>

        <div class="features-section">
            <h2 class="section-title">Как пользоваться</h2>
            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-icon">1</div>
                    <h3 class="feature-title">Выберите калькулятор</h3>
                    <p class="feature-text">Нажмите на нужный калькулятор выше</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">2</div>
                    <h3 class="feature-title">Введите данные</h3>
                    <p class="feature-text">Заполните поля: сумма, ставка, срок</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">3</div>
                    <h3 class="feature-title">Получите результат</h3>
                    <p class="feature-text">Смотрите расчет и экспортируйте в PDF</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 М2 Платформа калькуляторов недвижимости. Все расчеты носят справочный характер.</p>
            <p style="margin-top: 8px; font-size: 13px;">Для принятия финансовых решений обращайтесь к специалистам</p>
        </div>
    </footer>

    <!-- PWA Installation Prompt -->
    <div id="pwa-install-banner" class="pwa-banner" style="display: none;">
        <div class="pwa-content">
            <div class="pwa-icon">📱</div>
            <div class="pwa-text">
                <h4>Установить приложение?</h4>
                <p>Добавьте М2 Калькуляторы на главный экран для быстрого доступа</p>
            </div>
            <div class="pwa-actions">
                <button id="pwa-install-btn" class="pwa-btn pwa-btn-install">Установить</button>
                <button id="pwa-dismiss-btn" class="pwa-btn pwa-btn-dismiss">Отмена</button>
            </div>
        </div>
    </div>

    <script>
        // PWA Installation and Service Worker
        let deferredPrompt;
        let installBanner = document.getElementById('pwa-install-banner');
        let installBtn = document.getElementById('pwa-install-btn');
        let dismissBtn = document.getElementById('pwa-dismiss-btn');

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install banner after a delay
            setTimeout(() => {
                if (!localStorage.getItem('pwa-dismissed')) {
                    showInstallBanner();
                }
            }, 3000);
        });

        // Show install banner
        function showInstallBanner() {
            if (installBanner) {
                installBanner.style.display = 'block';
                installBanner.style.animation = 'slideUp 0.3s ease-out';
            }
        }

        // Hide install banner
        function hideInstallBanner() {
            if (installBanner) {
                installBanner.style.animation = 'slideDown 0.3s ease-out';
                setTimeout(() => {
                    installBanner.style.display = 'none';
                }, 300);
            }
        }

        // Install button click
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('PWA installed');
                    } else {
                        console.log('PWA installation dismissed');
                    }
                    
                    deferredPrompt = null;
                    hideInstallBanner();
                }
            });
        }

        // Dismiss button click
        if (dismissBtn) {
            dismissBtn.addEventListener('click', () => {
                hideInstallBanner();
                localStorage.setItem('pwa-dismissed', 'true');
                
                // Show again after 7 days
                setTimeout(() => {
                    localStorage.removeItem('pwa-dismissed');
                }, 7 * 24 * 60 * 60 * 1000);
            });
        }

        // App installed event
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA was installed');
            hideInstallBanner();
        });

        // Update notification
        function showUpdateNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Обновление доступно', {
                    body: 'Новая версия М2 Калькуляторов готова к установке',
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/icon-72x72.png'
                });
            } else {
                // Fallback to custom notification
                showCustomNotification('Обновление доступно', 'Перезагрузите страницу для получения новых возможностей');
            }
        }

        // Custom notification
        function showCustomNotification(title, message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #007bff;
                color: white;
                padding: 16px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                cursor: pointer;
            `;
            notification.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 4px;">${title}</div>
                <div style="font-size: 14px; opacity: 0.9;">${message}</div>
            `;
            
            notification.onclick = () => window.location.reload();
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            setTimeout(() => {
                Notification.requestPermission();
            }, 10000); // Request after 10 seconds
        }

        // Check if running as PWA
        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches ||
                   window.navigator.standalone ||
                   document.referrer.includes('android-app://') ||
                   localStorage.getItem('isPWA') === 'true';
        }

        // Add PWA styles if running as standalone app
        if (isPWA()) {
            document.body.classList.add('pwa-mode');
            localStorage.setItem('isPWA', 'true');
        }

        // Add CSS for PWA banner
        const pwaStyles = document.createElement('style');
        pwaStyles.textContent = `
            .pwa-banner {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #007bff, #0056b3);
                color: white;
                z-index: 10000;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.2);
            }
            
            .pwa-content {
                display: flex;
                align-items: center;
                padding: 16px 20px;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .pwa-icon {
                font-size: 32px;
                margin-right: 16px;
            }
            
            .pwa-text {
                flex: 1;
            }
            
            .pwa-text h4 {
                margin: 0 0 4px 0;
                font-size: 16px;
                font-weight: 600;
            }
            
            .pwa-text p {
                margin: 0;
                font-size: 14px;
                opacity: 0.9;
            }
            
            .pwa-actions {
                display: flex;
                gap: 12px;
                margin-left: 16px;
            }
            
            .pwa-btn {
                padding: 8px 16px;
                border: none;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .pwa-btn-install {
                background: white;
                color: #007bff;
            }
            
            .pwa-btn-install:hover {
                background: #f8f9fa;
                transform: scale(1.05);
            }
            
            .pwa-btn-dismiss {
                background: rgba(255, 255, 255, 0.1);
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.3);
            }
            
            .pwa-btn-dismiss:hover {
                background: rgba(255, 255, 255, 0.2);
            }
            
            @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
            }
            
            @keyframes slideDown {
                from { transform: translateY(0); }
                to { transform: translateY(100%); }
            }
            
            @media (max-width: 768px) {
                .pwa-content {
                    flex-direction: column;
                    text-align: center;
                    padding: 20px;
                }
                
                .pwa-icon {
                    margin: 0 0 12px 0;
                }
                
                .pwa-text {
                    margin-bottom: 16px;
                }
                
                .pwa-actions {
                    margin: 0;
                    width: 100%;
                }
                
                .pwa-btn {
                    flex: 1;
                }
            }
            
            body.pwa-mode {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        `;
        document.head.appendChild(pwaStyles);
    </script>
</body>
</html>
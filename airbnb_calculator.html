<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>М2 — Калькулятор доходности краткосрочной аренды</title>
    <link rel="stylesheet" href="m2-theme.css">
    <link rel="stylesheet" href="m2-header.css">
    <link rel="stylesheet" href="m2-ui-components.css">
    <link rel="stylesheet" href="quick-fixes.css">
    <meta name="description" content="Калькулятор краткосрочной и посуточной аренды от М2. Рассчитайте доходность, загрузку, расходы на содержание. Учитывает налоги и управление.">
    <meta name="keywords" content="краткосрочная аренда калькулятор, посуточная аренда, доходность недвижимости, М2, доход от аренды, суточная аренда">
    <meta property="og:title" content="М2 — Калькулятор доходности краткосрочной аренды">
    <meta property="og:description" content="Калькулятор краткосрочной и посуточной аренды от М2. Рассчитайте доходность, загрузку, расходы.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://m2-calculators-dfol1ftj8-nikita-tita-projects.vercel.app/airbnb_calculator.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="М2 — Калькулятор доходности краткосрочной аренды">
    <meta name="twitter:description" content="Калькулятор краткосрочной и посуточной аренды от М2. Рассчитайте доходность, загрузку, расходы.">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#4F2CD9">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="tooltip-system.js"></script>
    <script src="pdf-export.js"></script>
    <script src="components.js"></script>
    <script src="ux-enhancements.js"></script>
    <script src="advanced-ux-enhancements.js"></script>
    <script src="analytics.js"></script>
    <script src="m2-enhancements-loader.js"></script>
    <!-- Яндекс.Метрика -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js?id=104341432", "ym");
   ym(104341432, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true,webvisor:true,trackHash:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/104341432" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Яндекс.Метрика -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            color: #4F2CD9 !important;
            font-size: 48px;
            font-weight: 700;
            color: #4F2CD9;
            margin-bottom: 12px;
        }

        .title {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
        }

        .back-link {
            color: #4F2CD9 !important;
            color: #4F2CD9;
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .calculator {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 40px;
        }

        .inputs, .results {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #333;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .input-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .input-field {
            width: 100%;
            padding: 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: border-color 0.2s;
            appearance: textfield;
        }

        .input-field:focus {
            outline: none;
            border-color: #4F2CD9;
        }

        .input-field::-webkit-outer-spin-button,
        .input-field::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .quick-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: #4F2CD9;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
            min-height: 44px;
        }

        .quick-btn:hover, .quick-btn.active {
            background: #3F23AE;
        }

        .result-item {
            margin-bottom: 24px;
        }

        .result-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        .result-value {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .result-value.primary {
            color: #4F2CD9;
            font-size: 36px;
        }

        .result-value.success {
            color: #28a745;
        }

        .result-value.warning {
            color: #ffc107;
        }

        .result-value.danger {
            color: #dc3545;
        }

        .comparison-section {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .comparison-card {
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            color: white;
        }

        .comparison-card.shortterm {
            background: linear-gradient(135deg, #ff5a5f, #c13515);
        }

        .comparison-card.longterm {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .comparison-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .comparison-yield {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .comparison-details {
            font-size: 14px;
            opacity: 0.9;
        }

        .seasonal-analysis {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .month-item {
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .month-name {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .month-rate {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .month-income {
            font-size: 12px;
            color: #28a745;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn, .btn-primary {
            background: #4F2CD9;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
            min-height: 48px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover, .btn-primary:hover {
            background: #3F23AE;
        }

        .btn-secondary {
            background: #797981;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
            min-height: 48px;
        }

        .btn-secondary:hover {
            background: #5A5A61;
        }

        /* Parameter Groups */
        .parameter-group {
            margin-bottom: 32px;
            padding: 24px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid #e9ecef;
        }

        .group-header {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 10px;
        }

        .group-header h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .group-description {
            color: #666;
            font-size: 14px;
            font-style: italic;
            flex-basis: 100%;
        }

        @media (max-width: 768px) {
            .calculator {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .container {
                padding: 24px 16px;
            }

            .inputs, .results, .comparison-section, .seasonal-analysis {
                padding: 24px;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .month-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
        @media (max-width: 768px) {
            .container { padding: 20px 15px; }
            .input-field, .input-field select { font-size: 16px; padding: 14px; min-height: 48px; }
            .quick-btn { padding: 12px 16px; font-size: 14px; min-height: 44px; }
            .btn, .btn-primary, .btn-secondary { min-height: 48px; padding: 16px 24px; font-size: 16px; }
            .grid-2 { grid-template-columns: 1fr !important; }
            .results-grid { grid-template-columns: 1fr !important; }
            table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        }
        @media (max-width: 375px) {
            .container { padding: 12px 8px; }
            .header h1, .title { font-size: 24px; }
        }
    </style>
</head>
<body>
    <!-- M2.ru Header -->
    <header class="m2-header">
        <div class="m2-header-content">
            <!-- Logo -->
            <div class="m2-header-logo">
                <a href="https://m2.ru/" target="_blank" rel="noopener">
                    <svg width="58" height="52" viewBox="0 0 58 52" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M17 0H58V41H41V52H0V11H17V0Z" fill="#3216B5"></path>
                        <path d="M44.157 27.392V24.6531H37.5997V24.6298C39.9124 23.6013 43.9483 21.8471 43.9483 18.1997C43.9483 15.3184 41.5538 12.8572 38.1712 12.8572C34.7887 12.8572 33.0611 15.1883 32.3001 17.2899L34.8036 18.2698C35.3685 16.5165 36.363 15.4468 38.1945 15.4468C39.794 15.4468 41.1117 16.6404 40.9809 18.223C40.8122 20.2646 38.6293 21.7447 36.6206 22.8487C35.0867 23.692 32.7112 24.889 32.7112 24.889V27.392H44.157Z" fill="white"></path>
                        <path d="M12.0522 24.663V38.3574H15.0083V28.0866L19.2383 38.3574H21.4807L25.6344 28.0866V38.3574H28.6158V24.663H24.3094L20.334 34.4851L16.3333 24.663H12.0522Z" fill="white"></path>
                    </svg>
                </a>
            </div>

            <!-- Navigation -->
            <nav class="m2-header-nav">
                <div class="m2-header-nav-menu">
                    <a href="https://m2.ru/moskva/novostroyki/" target="_blank" rel="noopener" class="m2-header-nav-link">Новостройки</a>
                    <a href="https://m2.ru/ipoteka/" target="_blank" rel="noopener" class="m2-header-nav-link">Ипотека</a>
                    <a href="https://m2.ru/services/deal/" target="_blank" rel="noopener" class="m2-header-nav-link">Сделка</a>
                    <a href="index.html" class="m2-header-nav-link m2-header-nav-link-active">Калькуляторы</a>
                </div>
            </nav>

            <!-- User Actions -->
            <div class="m2-header-actions">
                <a href="https://m2.ru/login/" target="_blank" rel="noopener" class="m2-header-login-btn">Войти</a>
            </div>
        </div>
    </header>

    <div class="container">
        <a href="index.html" class="back-link">← Вернуться к калькуляторам</a>

        <div class="header">
            <h1 class="title">Калькулятор краткосрочной аренды</h1>
            <p class="subtitle">Рассчитайте доходность от краткосрочной и посуточной аренды</p>
        </div>

        <div class="calculator">
            <div class="inputs">
                <!-- Группа доходов -->
                <div class="parameter-group">
                    <div class="group-header">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="m17 5-5 5-5-5"></path>
                                <path d="m17 13-5 5-5-5"></path>
                            </svg>
                            Доходы от аренды
                        </h3>
                        <div class="group-description">Основные параметры получения дохода</div>
                    </div>
                
                <div class="input-group">
                    <label class="input-label" for="propertyPrice">Стоимость недвижимости</label>
                    <input type="number" id="propertyPrice" class="input-field" value="8000000" min="500000" max="50000000" step="100000">
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('propertyPrice', 5000000)">5 млн</button>
                        <button class="quick-btn active" onclick="setValue('propertyPrice', 8000000)">8 млн</button>
                        <button class="quick-btn" onclick="setValue('propertyPrice', 12000000)">12 млн</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="dailyRate">Средняя ставка за сутки</label>
                    <input type="number" id="dailyRate" class="input-field" value="4500" min="1000" max="50000" step="100">
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('dailyRate', 3000)">3000 ₽</button>
                        <button class="quick-btn active" onclick="setValue('dailyRate', 4500)">4500 ₽</button>
                        <button class="quick-btn" onclick="setValue('dailyRate', 7000)">7000 ₽</button>
                        <button class="quick-btn" onclick="setValue('dailyRate', 10000)">10000 ₽</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="occupancyRate">Загруженность, % <span class="help-icon tooltip-trigger" data-term="occupancy-rate">?</span></label>
                    <input type="number" id="occupancyRate" class="input-field" value="65" min="10" max="95" step="1">
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('occupancyRate', 50)">50%</button>
                        <button class="quick-btn active" onclick="setValue('occupancyRate', 65)">65%</button>
                        <button class="quick-btn" onclick="setValue('occupancyRate', 80)">80%</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="cleaningFee">Плата за уборку <span class="help-icon tooltip-trigger" data-term="cleaning-fee">?</span></label>
                    <input type="number" id="cleaningFee" class="input-field" value="2000" min="500" max="10000" step="100">
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('cleaningFee', 1500)">1500 ₽</button>
                        <button class="quick-btn active" onclick="setValue('cleaningFee', 2000)">2000 ₽</button>
                        <button class="quick-btn" onclick="setValue('cleaningFee', 3000)">3000 ₽</button>
                    </div>
                </div>
                </div>

                <!-- Группа расходов -->
                <div class="parameter-group">
                    <div class="group-header">
                        <h3>📉 Расходы и комиссии</h3>
                        <div class="group-description">Затраты на обслуживание и платформы</div>
                    </div>

                <div class="input-group">
                    <label class="input-label" for="platformCommission">Комиссия платформы, % <span class="help-icon tooltip-trigger" data-term="platform-commission">?</span></label>
                    <input type="number" id="platformCommission" class="input-field" value="3" min="0" max="20" step="0.5">
                    <div class="quick-buttons">
                        <button class="quick-btn active" onclick="setValue('platformCommission', 3)">Низкая 3%</button>
                        <button class="quick-btn" onclick="setValue('platformCommission', 15)">Высокая 15%</button>
                        <button class="quick-btn" onclick="setValue('platformCommission', 0)">Прямые 0%</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="operatingExpenses">Операционные расходы в месяц</label>
                    <input type="number" id="operatingExpenses" class="input-field" value="25000" min="5000" max="100000" step="1000">
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('operatingExpenses', 15000)">15 тыс</button>
                        <button class="quick-btn active" onclick="setValue('operatingExpenses', 25000)">25 тыс</button>
                        <button class="quick-btn" onclick="setValue('operatingExpenses', 40000)">40 тыс</button>
                    </div>
                </div>
                </div>

                <!-- Группа сравнения -->
                <div class="parameter-group">
                    <div class="group-header">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                                <path d="M3 3v18h18"></path>
                                <path d="m19 9-5 5-4-4-3 3"></path>
                            </svg>
                            Параметры сравнения
                        </h3>
                        <div class="group-description">Данные для анализа альтернативных вложений</div>
                    </div>

                <div class="input-group">
                    <label class="input-label" for="longTermRate">Долгосрочная аренда (сравнение)</label>
                    <input type="number" id="longTermRate" class="input-field" value="80000" min="20000" max="500000" step="5000">
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('longTermRate', 60000)">60 тыс</button>
                        <button class="quick-btn active" onclick="setValue('longTermRate', 80000)">80 тыс</button>
                        <button class="quick-btn" onclick="setValue('longTermRate', 120000)">120 тыс</button>
                    </div>
                </div>
                </div>
            </div>

            <div class="results">
                <h2 class="section-title">Результаты расчета</h2>
                
                <div class="result-item">
                    <div class="result-label">Доход в месяц</div>
                    <div class="result-value primary" id="monthlyIncome">87 750 ₽</div>
                </div>

                <div class="result-item">
                    <div class="result-label">Чистая прибыль в месяц</div>
                    <div class="result-value success" id="netProfit">54 130 ₽</div>
                </div>

                <div class="result-item">
                    <div class="result-label">Доходность в год</div>
                    <div class="result-value" id="annualYield">8.1%</div>
                </div>

                <div class="result-item">
                    <div class="result-label">Загруженных дней в месяц</div>
                    <div class="result-value" id="occupiedDays">19.5</div>
                </div>
            </div>
        </div>

        <!-- Comparison Section -->
        <div class="comparison-section">
            <h2 class="section-title">Сравнение с долгосрочной арендой</h2>
            <div class="comparison-grid">
                <div class="comparison-card shortterm">
                    <div class="comparison-title">Краткосрочная аренда</div>
                    <div class="comparison-yield" id="shorttermYield">8.1%</div>
                    <div class="comparison-details" id="shorttermIncome">54 130 ₽/мес</div>
                </div>
                <div class="comparison-card longterm">
                    <div class="comparison-title">Долгосрочная аренда</div>
                    <div class="comparison-yield" id="longTermYield">9.6%</div>
                    <div class="comparison-details" id="longTermIncome">65 000 ₽/мес</div>
                </div>
            </div>
        </div>

        <!-- Seasonal Analysis -->
        <div class="seasonal-analysis">
            <h2 class="section-title">Сезонный анализ доходности</h2>
            <div class="month-grid" id="seasonalGrid">
                <!-- Будет заполнено JavaScript -->
            </div>
        </div>

        <!-- Детализация расчетов -->
        <div class="calculation-details" style="margin: 40px 0; background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <div class="details-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px;">
                <h3 style="margin: 0; color: #3416b6; font-size: 24px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                        <path d="M3 3v18h18"></path>
                        <path d="m19 9-5 5-4-4-3 3"></path>
                    </svg>
                    Как мы считаем
                </h3>
                <button type="button" onclick="toggleCalculationDetails()" style="background: #3416b6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    Показать расчеты
                </button>
            </div>
            
            <div id="detailsContent" style="display: none;">
                <div class="calculation-steps" id="calculationSteps"></div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="exportToPDF()">
                Экспорт в PDF
            </button>
            <button class="btn btn-primary" onclick="exportToExcel()" style="background: #4F2CD9;">
                📊 Excel
            </button>
            <button class="btn btn-secondary" onclick="resetCalculator()">
                Сбросить
            </button>
        </div>
    </div>

    <script>
        function formatNumber(num) {
            return new Intl.NumberFormat('ru-RU').format(Math.round(num));
        }

        function formatPercent(num) {
            return num.toFixed(1) + '%';
        }

        function formatCurrencyAdvanced(amount, options = {}) {
            if (window.advancedUX) {
                return window.advancedUX.formatCurrency(amount, options);
            }
            return formatNumber(amount) + ' ₽';
        }

        function formatPercentAdvanced(percent, options = {}) {
            if (window.advancedUX) {
                return window.advancedUX.formatPercent(percent, options);
            }
            return formatPercent(percent);
        }

        function setValue(inputId, value) {
            document.getElementById(inputId).value = value;
            
            const group = document.getElementById(inputId).closest('.input-group');
            if (group) {
                group.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
            }
            
            calculateShortterm();
        }

        function calculateShortterm() {
            if (typeof ym !== 'undefined') {
                ym(104341432, 'reachGoal', 'calculation_made', {calculator: 'airbnb'});
            }
            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value) || 0;
            const dailyRate = parseFloat(document.getElementById('dailyRate').value) || 0;
            const occupancyRate = parseFloat(document.getElementById('occupancyRate').value) || 0;
            const cleaningFee = parseFloat(document.getElementById('cleaningFee').value) || 0;
            const platformCommission = parseFloat(document.getElementById('platformCommission').value) || 0;
            const operatingExpenses = parseFloat(document.getElementById('operatingExpenses').value) || 0;
            const longTermRate = parseFloat(document.getElementById('longTermRate').value) || 0;

            if (propertyPrice <= 0 || dailyRate <= 0) {
                return;
            }

            // Расчет краткосрочной аренды
            const daysInMonth = 30;
            const occupiedDays = (daysInMonth * occupancyRate) / 100;
            
            // Предполагаем среднюю продолжительность аренды 2.5 дня (количество заселений = дни / 2.5)
            const averageStayLength = 2.5;
            const numberOfBookings = occupiedDays / averageStayLength;
            const grossRevenue = (dailyRate * occupiedDays) + (cleaningFee * numberOfBookings);
            const platformFee = grossRevenue * (platformCommission / 100);
            const netRevenue = grossRevenue - platformFee;
            const monthlyProfit = netRevenue - operatingExpenses;
            
            const annualProfit = monthlyProfit * 12;
            const annualYield = (annualProfit / propertyPrice) * 100;

            // ИСПРАВЛЕНО: Расчет долгосрочной аренды с детальным разделением расходов
            // При долгосрочной аренде:
            // - Нет расходов на частую уборку (экономия ~35% от операционных расходов)
            // - Нет комиссии платформы (она уже включена в operatingExpenses для краткосрочной)
            // - Но сохраняются коммунальные, ремонт, управление
            const cleaningCostPortion = 0.35; // Примерно 35% от операционных расходов - уборка
            const platformFeePortion = platformCommission / 100; // Комиссия платформы

            // Долгосрочная аренда: убираем расходы на уборку и платформу
            const longTermExpenses = operatingExpenses * (1 - cleaningCostPortion);
            const longTermProfit = longTermRate - longTermExpenses;
            const longTermYield = ((longTermProfit * 12) / propertyPrice) * 100;

            // Обновляем результаты с улучшенным форматированием
            document.getElementById('monthlyIncome').innerHTML = formatCurrencyAdvanced(netRevenue, { colorCode: false });
            document.getElementById('netProfit').innerHTML = formatCurrencyAdvanced(monthlyProfit, { 
                colorCode: true, 
                showSign: monthlyProfit !== 0 
            });
            document.getElementById('annualYield').innerHTML = formatPercentAdvanced(annualYield, { 
                colorCode: true, 
                benchmark: 8.0 
            });
            document.getElementById('occupiedDays').textContent = occupiedDays.toFixed(1);

            // Обновляем сравнение
            document.getElementById('shorttermYield').innerHTML = formatPercentAdvanced(annualYield, { colorCode: false });
            document.getElementById('shorttermIncome').innerHTML = formatCurrencyAdvanced(monthlyProfit, { colorCode: false }) + '/мес';
            document.getElementById('longTermYield').innerHTML = formatPercentAdvanced(longTermYield, { colorCode: false });
            document.getElementById('longTermIncome').innerHTML = formatCurrencyAdvanced(longTermProfit, { colorCode: false }) + '/мес';

            updateSeasonalAnalysis(dailyRate, occupiedDays, cleaningFee, platformCommission, operatingExpenses);
            
            // Обновляем детализацию расчетов
            updateCalculationDetails();
        }

        function updateSeasonalAnalysis(baseRate, baseOccupancy, cleaningFee, commission, expenses) {
            // ИСПРАВЛЕНО: Разделены коэффициенты для цены и занятости
            const months = [
                { name: 'Янв', priceMultiplier: 0.85, occupancyMultiplier: 0.8 },
                { name: 'Фев', priceMultiplier: 0.9, occupancyMultiplier: 0.85 },
                { name: 'Мар', priceMultiplier: 0.95, occupancyMultiplier: 0.9 },
                { name: 'Апр', priceMultiplier: 1.0, occupancyMultiplier: 1.0 },
                { name: 'Май', priceMultiplier: 1.15, occupancyMultiplier: 1.05 },
                { name: 'Июн', priceMultiplier: 1.3, occupancyMultiplier: 1.1 },
                { name: 'Июл', priceMultiplier: 1.5, occupancyMultiplier: 1.0 },  // Высокий сезон: цены выше, но занятость не превышает 100%
                { name: 'Авг', priceMultiplier: 1.4, occupancyMultiplier: 1.0 },
                { name: 'Сен', priceMultiplier: 1.1, occupancyMultiplier: 1.0 },
                { name: 'Окт', priceMultiplier: 1.0, occupancyMultiplier: 0.95 },
                { name: 'Ноя', priceMultiplier: 0.9, occupancyMultiplier: 0.85 },
                { name: 'Дек', priceMultiplier: 1.0, occupancyMultiplier: 0.9 }   // Новый год: цены нормальные, занятость средняя
            ];

            const grid = document.getElementById('seasonalGrid');
            grid.innerHTML = '';

            months.forEach(month => {
                const seasonalRate = baseRate * month.priceMultiplier;
                const seasonalOccupancy = Math.min(baseOccupancy * month.occupancyMultiplier, 30);
                
                const grossRevenue = (seasonalRate * seasonalOccupancy) + (cleaningFee * seasonalOccupancy * 0.5);
                const platformFee = grossRevenue * (commission / 100);
                const netRevenue = grossRevenue - platformFee;
                const monthlyProfit = netRevenue - expenses;

                const monthItem = document.createElement('div');
                monthItem.className = 'month-item';
                monthItem.innerHTML = `
                    <div class="month-name">${month.name}</div>
                    <div class="month-rate">${formatNumber(seasonalRate)} ₽</div>
                    <div class="month-income">${formatNumber(monthlyProfit)} ₽</div>
                `;
                grid.appendChild(monthItem);
            });
        }

        function resetCalculator() {
            document.getElementById('propertyPrice').value = 8000000;
            document.getElementById('dailyRate').value = 4500;
            document.getElementById('occupancyRate').value = 65;
            document.getElementById('cleaningFee').value = 2000;
            document.getElementById('platformCommission').value = 3;
            document.getElementById('operatingExpenses').value = 25000;
            document.getElementById('longTermRate').value = 80000;
            calculateShortterm();
        }

        function exportToPDF() {
            if (typeof ym !== 'undefined') {
                ym(104341432, 'reachGoal', 'pdf_export', {calculator: 'airbnb'});
            }
            // Use the improved PDF export system
            exportAirbnbToPDF();
        }

        function exportToExcel() {
            if (typeof ym !== 'undefined') {
                ym(104341432, 'reachGoal', 'excel_export', {calculator: 'airbnb'});
            }
            let csvContent = '\uFEFF';
            csvContent += 'М2 - Краткосрочная аренда\n';
            csvContent += `Дата расчёта,${new Date().toLocaleString('ru-RU')}\n\n`;
            // Add calculator-specific data here based on inputs
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.setAttribute('href', URL.createObjectURL(blob));
            link.setAttribute('download', `m2_airbnb_${new Date().getTime()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Excel файл успешно загружен', 'success');
        }

        // Функции для детализации расчетов
        function toggleCalculationDetails() {
            const content = document.getElementById('detailsContent');
            const button = content.previousElementSibling.querySelector('button');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                button.textContent = 'Скрыть расчеты';
                updateCalculationDetails();
            } else {
                content.style.display = 'none';
                button.textContent = 'Показать расчеты';
            }
        }

        function updateCalculationDetails() {
            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value) || 0;
            const dailyRate = parseFloat(document.getElementById('dailyRate').value) || 0;
            const occupancyRate = parseFloat(document.getElementById('occupancyRate').value) || 0;
            const cleaningFee = parseFloat(document.getElementById('cleaningFee').value) || 0;
            const platformCommission = parseFloat(document.getElementById('platformCommission').value) || 0;
            const operatingExpenses = parseFloat(document.getElementById('operatingExpenses').value) || 0;
            const longTermRate = parseFloat(document.getElementById('longTermRate').value) || 0;

            const stepsContainer = document.getElementById('calculationSteps');
            
            // Расчеты
            const daysInMonth = 30;
            const occupiedDays = (daysInMonth * occupancyRate) / 100;
            const numberOfBookings = occupiedDays / 2.5; // средняя продолжительность аренды 2.5 дня
            const grossRevenue = (dailyRate * occupiedDays) + (cleaningFee * numberOfBookings);
            const platformFee = grossRevenue * (platformCommission / 100);
            const netRevenue = grossRevenue - platformFee;
            const monthlyProfit = netRevenue - operatingExpenses;
            const annualProfit = monthlyProfit * 12;
            const annualYield = (annualProfit / propertyPrice) * 100;

            // Расчеты для долгосрочной аренды
            const longTermExpenses = operatingExpenses * 0.4;
            const longTermProfit = longTermRate - longTermExpenses;
            const longTermYield = ((longTermProfit * 12) / propertyPrice) * 100;
            const advantage = monthlyProfit - longTermProfit;

            stepsContainer.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 20px;">
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-left: 4px solid #28a745;">
                        <h4 style="color: #28a745; margin-bottom: 20px; font-size: 18px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9,22 9,12 15,12 15,22"></polyline>
                            </svg>
                            Краткосрочная аренда
                        </h4>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>1. Занятость объекта:</strong><br>
                            ${occupancyRate}% от 30 дней = ${occupiedDays.toFixed(1)} дней
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>2. Валовый доход:</strong><br>
                            • Проживание: ${formatNumber(dailyRate)} × ${occupiedDays.toFixed(1)} = ${formatNumber(dailyRate * occupiedDays)} ₽<br>
                            • Уборка: ${formatNumber(cleaningFee)} × ${numberOfBookings.toFixed(1)} заселений = ${formatNumber(cleaningFee * numberOfBookings)} ₽<br>
                            = ${formatNumber(grossRevenue)} ₽
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>3. Комиссия платформы (${platformCommission}%):</strong><br>
                            ${formatNumber(grossRevenue)} × ${platformCommission}% = ${formatNumber(platformFee)} ₽
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>4. Чистый доход:</strong><br>
                            ${formatNumber(grossRevenue)} - ${formatNumber(platformFee)} = ${formatNumber(netRevenue)} ₽
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>5. Операционные расходы:</strong><br>
                            ${formatNumber(operatingExpenses)} ₽/мес
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>6. Чистая прибыль:</strong><br>
                            ${formatNumber(netRevenue)} - ${formatNumber(operatingExpenses)} = ${formatNumber(monthlyProfit)} ₽
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>7. Годовая доходность:</strong><br>
                            (${formatNumber(monthlyProfit)} × 12) ÷ ${formatNumber(propertyPrice)} × 100% = ${formatPercent(annualYield)}
                        </div>
                        
                        <div style="padding-top: 15px; border-top: 2px solid #28a745; font-weight: bold;">
                            <strong>Прибыль в месяц: ${formatNumber(monthlyProfit)} ₽</strong><br>
                            <strong>Доходность: ${formatPercent(annualYield)}</strong>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-left: 4px solid #007bff;">
                        <h4 style="color: #4F2CD9; margin-bottom: 20px; font-size: 18px;">🏢 Долгосрочная аренда</h4>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>1. Месячная аренда:</strong><br>
                            ${formatNumber(longTermRate)} ₽
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>2. Пустота и смена жильцов:</strong><br>
                            Стабильно весь месяц
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>3. Операционные расходы:</strong><br>
                            ${formatNumber(operatingExpenses)} × 40% = ${formatNumber(longTermExpenses)} ₽<br>
                            <small>(меньше расходов на обслуживание)</small>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>4. Чистая прибыль:</strong><br>
                            ${formatNumber(longTermRate)} - ${formatNumber(longTermExpenses)} = ${formatNumber(longTermProfit)} ₽
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>5. Годовая доходность:</strong><br>
                            (${formatNumber(longTermProfit)} × 12) ÷ ${formatNumber(propertyPrice)} × 100% = ${formatPercent(longTermYield)}
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>6. Преимущества:</strong><br>
                            • Стабильный доход<br>
                            • Меньше хлопот<br>
                            • Предсказуемые расходы
                        </div>
                        
                        <div style="padding-top: 15px; border-top: 2px solid #007bff; font-weight: bold;">
                            <strong>Прибыль в месяц: ${formatNumber(longTermProfit)} ₽</strong><br>
                            <strong>Доходность: ${formatPercent(longTermYield)}</strong>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, ${advantage > 0 ? '#e8f5e8' : '#fff3e0'}, ${advantage > 0 ? '#f0f9f0' : '#ffeaa7'}); border-radius: 12px; text-align: center;">
                    <h4 style="color: ${advantage > 0 ? '#2e7d32' : '#f57c00'}; margin-bottom: 15px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="m9 12 2 2 4-4"></path>
                        </svg>
                        Итоговое сравнение
                    </h4>
                    <p style="margin: 10px 0; color: #333; font-size: 18px;">
                        <strong>${advantage > 0 ? 'Краткосрочная аренда выгоднее' : 'Долгосрочная аренда выгоднее'} на ${formatNumber(Math.abs(advantage))} ₽ в месяц</strong>
                    </p>
                    <p style="margin: 10px 0; color: #666;">
                        Разница в годовой доходности: <strong>${(annualYield - longTermYield).toFixed(1)}%</strong>
                    </p>
                    <p style="margin: 10px 0; color: #666; font-size: 14px;">
                        * Учитывайте дополнительные факторы: время на управление, сезонность, риски
                    </p>
                </div>
            `;
        }

        // Debounced calculation functions
        let calculationTimeout = null;
        
        function debouncedCalculateShortterm() {
            clearTimeout(calculationTimeout);
            calculationTimeout = setTimeout(() => {
                calculateShortterm();
            }, 150); // Doherty Threshold compliance - under 400ms
        }

        // Event listeners with debouncing
        document.getElementById('propertyPrice').addEventListener('input', debouncedCalculateShortterm);
        document.getElementById('dailyRate').addEventListener('input', debouncedCalculateShortterm);
        document.getElementById('occupancyRate').addEventListener('input', debouncedCalculateShortterm);
        document.getElementById('cleaningFee').addEventListener('input', debouncedCalculateShortterm);
        document.getElementById('platformCommission').addEventListener('input', debouncedCalculateShortterm);
        document.getElementById('operatingExpenses').addEventListener('input', debouncedCalculateShortterm);
        document.getElementById('longTermRate').addEventListener('input', debouncedCalculateShortterm);

        // Initial calculation
        calculateShortterm();
        
        // Initialize UX enhancements
        document.addEventListener('DOMContentLoaded', function() {
            if (window.uxEnhancer) {
                // Highlight main comparison results
                setTimeout(() => {
                    window.uxEnhancer.highlightMainResult('.comparison-card.shortterm');
                    window.uxEnhancer.groupResults(['.comparison-card', '.seasonal-analysis']);
                }, 100);
            }

            // Apply advanced UX enhancements
            if (window.advancedUX) {
                // Group calculation results using cognitive load principles
                const resultsContainer = document.querySelector('.results');
                if (resultsContainer) {
                    window.advancedUX.groupInformation(resultsContainer, 5);
                }

                // Add progressive disclosure to seasonal analysis
                const seasonalSection = document.querySelector('.seasonal-analysis');
                if (seasonalSection) {
                    // Convert seasonal grid to progressive disclosure
                    const seasonalGrid = seasonalSection.querySelector('.month-grid');
                    const seasonalContent = seasonalGrid.outerHTML;
                    
                    const disclosureSection = window.advancedUX.createDisclosureSection(
                        'Подробный сезонный анализ по месяцам',
                        seasonalContent,
                        { priority: 'secondary', initiallyOpen: false }
                    );
                    
                    seasonalGrid.style.display = 'none';
                    seasonalSection.appendChild(disclosureSection);
                }

                // Add formula tooltips
                const yieldElement = document.getElementById('annualYield').parentElement;
                if (yieldElement) {
                    window.advancedUX.createFormulaTooltip(
                        yieldElement,
                        'Годовая доходность = (Чистая прибыль × 12) ÷ Стоимость недвижимости × 100%',
                        'Показывает процентную доходность инвестиций в год с учетом всех расходов'
                    );
                }

                // Setup input validation
                const priceInput = document.getElementById('propertyPrice');
                if (priceInput) {
                    priceInput.setAttribute('data-validation', 'positive,price');
                }

                const rateInput = document.getElementById('occupancyRate');
                if (rateInput) {
                    rateInput.setAttribute('data-validation', 'percentage');
                }

                // Initialize validation after setting attributes
                window.advancedUX.initializeValidation();
            }
        });
    </script>
<script src="m2-layout.js"></script>
</body>
</html>
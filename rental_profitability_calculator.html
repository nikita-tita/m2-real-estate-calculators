<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú2 ‚Äî –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</title>
    <link rel="stylesheet" href="m2-theme.css">
    <meta name="description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –æ—Ç –ú2. –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—é, –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫, –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å. –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π.">
    <meta name="keywords" content="–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã, –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è, –ú2, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, –∞—Ä–µ–Ω–¥–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å">
    <meta property="og:title" content="–ú2 ‚Äî –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏">
    <meta property="og:description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –æ—Ç –ú2. –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://m2-calculators-dfol1ftj8-nikita-tita-projects.vercel.app/rental_profitability_calculator.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="–ú2 ‚Äî –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏">
    <meta name="twitter:description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –æ—Ç –ú2. –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏.">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#4F2CD9">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="tooltip-system.js"></script>
    <script src="pdf-export.js"></script>
    <script src="components.js"></script>
    <script src="ux-enhancements.js"></script>
    <script src="advanced-ux-enhancements.js"></script>
    <script src="analytics.js"></script>
    <script src="m2-enhancements-loader.js"></script>

    <!-- –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ -->
    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();
       for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
       k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

       ym(98765432, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true,
            trackHash:true
       });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/98765432" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ -->

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 48px;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 12px;
        }

        .title {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
        }

        .back-link {
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        /* Payment Type Toggle */
        .payment-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .toggle-group {
            background: white;
            border-radius: 12px;
            padding: 4px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            display: flex;
            border: 1px solid #e9ecef;
        }

        .toggle-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .toggle-btn.active {
            background: #007bff;
            color: white;
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
        }

        /* Mode Switch */
        .mode-switch {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }

        .mode-toggle {
            background: white;
            border-radius: 12px;
            padding: 4px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            display: flex;
            border: 1px solid #e9ecef;
        }

        .mode-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .mode-btn.active {
            background: #007bff;
            color: white;
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
        }

        /* Calculator Layout */
        .calculator {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 40px;
        }

        .calculator.basic-mode {
            grid-template-columns: 1fr;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .inputs, .results {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #333;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .input-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .input-field {
            width: 100%;
            padding: 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: border-color 0.2s;
            appearance: textfield;
        }

        .input-field:focus {
            outline: none;
            border-color: #007bff;
        }

        .input-field::-webkit-outer-spin-button,
        .input-field::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Slider Control */
        .slider-control {
            margin-top: 12px;
            display: none;
        }

        .calculator.basic-mode .slider-control {
            display: block;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }

        .quick-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: #4F2CD9;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
            min-height: 44px;
        }

        .quick-btn:hover, .quick-btn.active {
            background: #3F23AE;
        }

        /* Mortgage Fields */
        .mortgage-fields {
            display: none;
        }

        .mortgage-fields.active {
            display: block;
        }

        /* Results */
        .result-item {
            margin-bottom: 24px;
        }

        .result-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        .result-value {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .result-value.primary {
            color: #007bff;
            font-size: 36px;
        }

        .result-value.success {
            color: #28a745;
        }

        .result-value.warning {
            color: #ffc107;
        }

        .result-value.danger {
            color: #dc3545;
        }

        /* Basic Mode Results */
        .basic-result {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .basic-result .result-value {
            font-size: 48px;
            color: #28a745;
            margin-bottom: 12px;
        }

        .basic-result .result-label {
            font-size: 18px;
            color: #666;
        }

        /* Advanced Features */
        .advanced-features {
            display: none;
        }

        .advanced-features.active {
            display: block;
        }

        /* Cash Flow Details */
        .cash-flow-details {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }

        .cash-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .cash-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 18px;
            color: #28a745;
            margin-top: 8px;
            padding-top: 16px;
            border-top: 2px solid #28a745;
        }

        .cash-label {
            color: #333;
        }

        .cash-value {
            font-weight: 600;
        }

        .cash-value.positive {
            color: #28a745;
        }

        .cash-value.negative {
            color: #dc3545;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn, .btn-primary {
            background: #4F2CD9;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
            min-height: 48px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover, .btn-primary:hover {
            background: #3F23AE;
        }

        .btn-secondary {
            background: #797981;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
            min-height: 48px;
        }

        .btn-secondary:hover {
            background: #5A5A61;
        }

        /* Calculation Details */
        .calculation-details {
            background: #f8f9fa;
            border-radius: 12px;
            margin: 32px 0;
            overflow: hidden;
            border: 1px solid #e9ecef;
        }

        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .details-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .details-toggle {
            background: none;
            border: none;
            color: #007bff;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .details-toggle:hover {
            background: #f8f9fa;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
        }

        .details-toggle.active .toggle-icon {
            transform: rotate(180deg);
        }

        .details-content {
            padding: 0 24px;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .details-content.show {
            max-height: 800px;
            opacity: 1;
            padding: 24px;
        }

        .detail-step {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .detail-step:last-child {
            margin-bottom: 0;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: #007bff;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: #333;
            font-weight: 600;
        }

        .formula {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 8px;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }

        .formula-explanation {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            font-style: italic;
        }

        .calculation {
            background: #f1f8e9;
            padding: 12px;
            border-radius: 6px;
            font-weight: 500;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        @media (max-width: 768px) {
            .calculator {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .calculator.basic-mode {
                max-width: none;
            }

            .container {
                padding: 24px 16px;
            }

            .inputs, .results, .cash-flow-details {
                padding: 24px;
            }

            .basic-result .result-value {
                font-size: 36px;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .payment-toggle, .mode-switch {
                flex-direction: column;
                align-items: center;
            }

            .toggle-group, .mode-toggle {
                width: 100%;
                max-width: 300px;
            }
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .input-field, .input-field select {
                font-size: 16px;
                padding: 14px;
                min-height: 48px;
            }

            .quick-btn {
                padding: 12px 16px;
                font-size: 14px;
                min-height: 44px;
            }

            .btn, .btn-primary, .btn-secondary {
                min-height: 48px;
                padding: 16px 24px;
                font-size: 16px;
            }

            .grid-2 {
                grid-template-columns: 1fr !important;
            }

            .results-grid {
                grid-template-columns: 1fr !important;
            }

            table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-width: 375px) {
            .container {
                padding: 12px 8px;
            }

            .header h1, .title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞–º</a>
        
        <div class="header">
            <div class="logo">–ú2</div>
            <h1 class="title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h1>
            <p class="subtitle">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</p>
        </div>

        <!-- Payment Type Toggle -->
        <div class="payment-toggle">
            <div class="toggle-group">
                <button class="toggle-btn active" onclick="switchPaymentType('cash')">–ó–∞ –Ω–∞–ª–∏—á–Ω—ã–µ</button>
                <button class="toggle-btn" onclick="switchPaymentType('mortgage')">–í –∏–ø–æ—Ç–µ–∫—É</button>
            </div>
        </div>

        <!-- Mode Switch -->
        <div class="mode-switch">
            <div class="mode-toggle">
                <button class="mode-btn active" onclick="switchMode('basic')">–ë–∞–∑–æ–≤—ã–π</button>
                <button class="mode-btn" onclick="switchMode('advanced')">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π</button>
            </div>
        </div>

        <div class="calculator basic-mode" id="calculatorContainer">
            <div class="inputs">
                <h2 class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</h2>
                
                <div class="input-group">
                    <label class="input-label" for="propertyPrice">–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
                    <input type="number" id="propertyPrice" class="input-field" value="8000000" min="500000" max="50000000" step="100000">
                    <div class="slider-control">
                        <input type="range" id="propertyPriceSlider" class="slider" 
                               min="2000000" max="25000000" step="100000" value="8000000">
                        <div class="slider-labels">
                            <span>2 –º–ª–Ω</span>
                            <span>25 –º–ª–Ω</span>
                        </div>
                    </div>
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('propertyPrice', 5000000)">5 –º–ª–Ω</button>
                        <button class="quick-btn active" onclick="setValue('propertyPrice', 8000000)">8 –º–ª–Ω</button>
                        <button class="quick-btn" onclick="setValue('propertyPrice', 12000000)">12 –º–ª–Ω</button>
                        <button class="quick-btn" onclick="setValue('propertyPrice', 15000000)">15 –º–ª–Ω</button>
                    </div>
                </div>

                <!-- Mortgage Fields -->
                <div class="mortgage-fields" id="mortgageFields">
                    <div class="input-group">
                        <label class="input-label" for="downPayment">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å <span class="help-icon tooltip-trigger" data-term="down-payment">?</span></label>
                        <input type="number" id="downPayment" class="input-field" value="2400000" min="100000" step="100000">
                        <div class="quick-buttons">
                            <button class="quick-btn" onclick="setValue('downPayment', 1600000)">20%</button>
                            <button class="quick-btn active" onclick="setValue('downPayment', 2400000)">30%</button>
                            <button class="quick-btn" onclick="setValue('downPayment', 4000000)">50%</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="interestRate">–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞, % –≤ –≥–æ–¥ <span class="help-icon tooltip-trigger" data-term="mortgage-rate">?</span></label>
                        <input type="number" id="interestRate" class="input-field" value="12" min="1" max="30" step="0.1">
                        <div class="quick-buttons">
                            <button class="quick-btn" onclick="setValue('interestRate', 10)">10%</button>
                            <button class="quick-btn active" onclick="setValue('interestRate', 12)">12%</button>
                            <button class="quick-btn" onclick="setValue('interestRate', 15)">15%</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="loanTerm">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞, –ª–µ—Ç</label>
                        <input type="number" id="loanTerm" class="input-field" value="20" min="5" max="30" step="1">
                        <div class="quick-buttons">
                            <button class="quick-btn" onclick="setValue('loanTerm', 15)">15 –ª–µ—Ç</button>
                            <button class="quick-btn active" onclick="setValue('loanTerm', 20)">20 –ª–µ—Ç</button>
                            <button class="quick-btn" onclick="setValue('loanTerm', 25)">25 –ª–µ—Ç</button>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="monthlyRent">–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∞—Ä–µ–Ω–¥–Ω–∞—è –ø–ª–∞—Ç–∞</label>
                    <input type="number" id="monthlyRent" class="input-field" value="80000" min="10000" max="1000000" step="5000">
                    <div class="slider-control">
                        <input type="range" id="monthlyRentSlider" class="slider" 
                               min="20000" max="300000" step="5000" value="80000">
                        <div class="slider-labels">
                            <span>20 —Ç—ã—Å</span>
                            <span>300 —Ç—ã—Å</span>
                        </div>
                    </div>
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('monthlyRent', 50000)">50 —Ç—ã—Å</button>
                        <button class="quick-btn active" onclick="setValue('monthlyRent', 80000)">80 —Ç—ã—Å</button>
                        <button class="quick-btn" onclick="setValue('monthlyRent', 120000)">120 —Ç—ã—Å</button>
                        <button class="quick-btn" onclick="setValue('monthlyRent', 200000)">200 —Ç—ã—Å</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="monthlyExpenses">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</label>
                    <input type="number" id="monthlyExpenses" class="input-field" value="15000" min="0" step="1000">
                    <div class="slider-control">
                        <input type="range" id="monthlyExpensesSlider" class="slider" 
                               min="2000" max="50000" step="1000" value="15000">
                        <div class="slider-labels">
                            <span>2 —Ç—ã—Å</span>
                            <span>50 —Ç—ã—Å</span>
                        </div>
                    </div>
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('monthlyExpenses', 8000)">8 —Ç—ã—Å</button>
                        <button class="quick-btn active" onclick="setValue('monthlyExpenses', 15000)">15 —Ç—ã—Å</button>
                        <button class="quick-btn" onclick="setValue('monthlyExpenses', 25000)">25 —Ç—ã—Å</button>
                    </div>
                </div>

                <!-- Advanced Mode Fields -->
                <div class="advanced-features">
                    <div class="input-group">
                        <label class="input-label" for="vacancyRate">–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–µ–∑–∞–Ω—è—Ç–æ—Å—Ç–∏, % <span class="help-icon tooltip-trigger" data-term="vacancy-rate">?</span></label>
                        <input type="number" id="vacancyRate" class="input-field" value="5" min="0" max="50" step="1">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="propertyTax">–ù–∞–ª–æ–≥ –Ω–∞ –∏–º—É—â–µ—Å—Ç–≤–æ (–≤ –≥–æ–¥) <span class="help-icon tooltip-trigger" data-term="property-tax">?</span></label>
                        <input type="number" id="propertyTax" class="input-field" value="20000" min="0" step="1000">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="incomeTax">–ü–æ–¥–æ—Ö–æ–¥–Ω—ã–π –Ω–∞–ª–æ–≥, % <span class="help-icon tooltip-trigger" data-term="income-tax">?</span></label>
                        <input type="number" id="incomeTax" class="input-field" value="13" min="0" max="50" step="1">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="appreciation">–†–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, % –≤ –≥–æ–¥ <span class="help-icon tooltip-trigger" data-term="appreciation">?</span></label>
                        <input type="number" id="appreciation" class="input-field" value="3" min="0" max="20" step="0.5">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="investmentPeriod">–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞, –ª–µ—Ç</label>
                    <input type="number" id="investmentPeriod" class="input-field" value="10" min="1" max="30" step="1">
                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="setValue('investmentPeriod', 5)">5 –ª–µ—Ç</button>
                        <button class="quick-btn active" onclick="setValue('investmentPeriod', 10)">10 –ª–µ—Ç</button>
                        <button class="quick-btn" onclick="setValue('investmentPeriod', 15)">15 –ª–µ—Ç</button>
                        <button class="quick-btn" onclick="setValue('investmentPeriod', 20)">20 –ª–µ—Ç</button>
                    </div>
                </div>
            </div>

            <!-- Basic Mode Result -->
            <div class="basic-result" id="basicResult">
                <div class="result-value" id="basicNetYield">9.2%</div>
                <div class="result-label">–ß–∏—Å—Ç–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –≤ –≥–æ–¥</div>
            </div>

            <!-- Advanced Mode Results -->
            <div class="results advanced-features">
                <h2 class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>
                
                <div class="result-item">
                    <div class="result-label">–í–∞–ª–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</div>
                    <div class="result-value primary" id="grossYield">12.0%</div>
                </div>

                <div class="result-item">
                    <div class="result-label">–ß–∏—Å—Ç–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</div>
                    <div class="result-value success" id="netYield">9.2%</div>
                </div>

                <div class="result-item">
                    <div class="result-label">–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü</div>
                    <div class="result-value" id="monthlyNetIncome">61 333 ‚ÇΩ</div>
                </div>

                <div class="result-item">
                    <div class="result-label">–°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏</div>
                    <div class="result-value" id="paybackPeriod">10.9 –ª–µ—Ç</div>
                </div>
                
                <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ -->
                <div class="calculation-details">
                    <div class="details-header">
                        <h3>–ö–∞–∫ –º—ã —Å—á–∏—Ç–∞–µ–º –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</h3>
                        <button type="button" class="details-toggle" onclick="toggleCalculationDetails()">
                            <span class="toggle-text">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å—á–µ—Ç—ã</span>
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                    </div>
                    
                    <div class="details-content" id="calculationDetailsContent">
                        <div class="detail-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>–†–∞—Å—á–µ—Ç –≤–∞–ª–æ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</h4>
                                <div class="formula">–í–∞–ª–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å = (–ì–æ–¥–æ–≤–∞—è –∞—Ä–µ–Ω–¥–∞ / –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞) √ó 100%</div>
                                <div class="formula-explanation">
                                    –í–∞–ª–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
                                </div>
                                <div class="calculation" id="grossYieldCalculation">
                                    (100 000 √ó 12) / 10 000 000 √ó 100% = 12.0%
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>–†–∞—Å—á–µ—Ç —á–∏—Å—Ç–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</h4>
                                <div class="formula">–ß–∏—Å—Ç–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å = ((–ê—Ä–µ–Ω–¥–∞ - –†–∞—Å—Ö–æ–¥—ã) √ó 12 / –°—Ç–æ–∏–º–æ—Å—Ç—å) √ó 100%</div>
                                <div class="formula-explanation">
                                    –ß–∏—Å—Ç–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
                                </div>
                                <div class="calculation" id="netYieldCalculation">
                                    ((100 000 - 23 333) √ó 12) / 10 000 000 √ó 100% = 9.2%
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>–†–∞—Å—á–µ—Ç —Å—Ä–æ–∫–∞ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏</h4>
                                <div class="formula">–°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ = –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ / –ì–æ–¥–æ–≤–æ–π —á–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥</div>
                                <div class="formula-explanation">
                                    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –ª–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –æ–∫—É–ø—è—Ç—Å—è —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª—å—é
                                </div>
                                <div class="calculation" id="paybackCalculation">
                                    10 000 000 / (76 667 √ó 12) = 10.9 –ª–µ—Ç
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cash Flow Details -->
        <div class="cash-flow-details">
            <h2 class="section-title">–î–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫ –≤ –º–µ—Å—è—Ü</h2>
            <div class="cash-item">
                <div class="cash-label">–ê—Ä–µ–Ω–¥–Ω—ã–π –¥–æ—Ö–æ–¥</div>
                <div class="cash-value positive" id="rentIncome">80 000 ‚ÇΩ</div>
            </div>
            <div class="cash-item" id="mortgagePaymentRow" style="display: none;">
                <div class="cash-label">–í—ã–ø–ª–∞—Ç–∞ –ø–æ –∏–ø–æ—Ç–µ–∫–µ</div>
                <div class="cash-value negative" id="mortgagePayment">-45 000 ‚ÇΩ</div>
            </div>
            <div class="cash-item">
                <div class="cash-label">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</div>
                <div class="cash-value negative" id="managementCost">-6 000 ‚ÇΩ</div>
            </div>
            <div class="cash-item">
                <div class="cash-label">–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</div>
                <div class="cash-value negative" id="utilities">-4 000 ‚ÇΩ</div>
            </div>
            <div class="cash-item">
                <div class="cash-label">–†–µ–∑–µ—Ä–≤ –Ω–∞ —Ä–µ–º–æ–Ω—Ç</div>
                <div class="cash-value negative" id="repairReserve">-3 000 ‚ÇΩ</div>
            </div>
            <div class="cash-item">
                <div class="cash-label">–ù–∞–ª–æ–≥–∏</div>
                <div class="cash-value negative" id="taxes">-2 000 ‚ÇΩ</div>
            </div>
            <div class="cash-item">
                <div class="cash-label">–ß–∏—Å—Ç—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫</div>
                <div class="cash-value positive" id="netCashFlow">65 000 ‚ÇΩ</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="exportToPDF()">
                üìÑ PDF
            </button>
            <button class="btn btn-primary" onclick="exportToExcel()" style="background: #28a745;">
                üìä Excel
            </button>
            <button class="btn btn-secondary" onclick="resetCalculator()">
                üîÑ –°–±—Ä–æ—Å–∏—Ç—å
            </button>
        </div>
    </div>

    <script>
        let currentMode = 'basic';
        let currentPaymentType = 'cash';

        function formatNumber(num) {
            return new Intl.NumberFormat('ru-RU').format(Math.round(num));
        }

        function formatCurrency(amount) {
            if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1).replace('.0', '') + ' –º–ª–Ω ‚ÇΩ';
            } else if (amount >= 1000) {
                return (amount / 1000).toFixed(0) + ' —Ç—ã—Å ‚ÇΩ';
            }
            return new Intl.NumberFormat('ru-RU').format(amount) + ' ‚ÇΩ';
        }

        function formatPercent(num) {
            return num.toFixed(1) + '%';
        }

        function setValue(inputId, value) {
            document.getElementById(inputId).value = value;
            
            const slider = document.getElementById(inputId + 'Slider');
            if (slider) {
                slider.value = value;
            }
            
            const group = document.getElementById(inputId).closest('.input-group');
            if (group) {
                group.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
            }
            
            calculateProfitability();
        }

        function switchPaymentType(type) {
            currentPaymentType = type;
            const toggleButtons = document.querySelectorAll('.payment-toggle .toggle-btn');
            const mortgageFields = document.getElementById('mortgageFields');
            const mortgagePaymentRow = document.getElementById('mortgagePaymentRow');

            toggleButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (type === 'mortgage') {
                mortgageFields.classList.add('active');
                mortgagePaymentRow.style.display = 'flex';
            } else {
                mortgageFields.classList.remove('active');
                mortgagePaymentRow.style.display = 'none';
            }

            calculateProfitability();
        }

        function switchMode(mode) {
            currentMode = mode;
            const calculatorContainer = document.getElementById('calculatorContainer');
            const modeButtons = document.querySelectorAll('.mode-btn');
            const advancedFeatures = document.querySelectorAll('.advanced-features');

            modeButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (mode === 'basic') {
                calculatorContainer.classList.add('basic-mode');
                advancedFeatures.forEach(feature => feature.classList.remove('active'));
            } else {
                calculatorContainer.classList.remove('basic-mode');
                advancedFeatures.forEach(feature => feature.classList.add('active'));
            }

            calculateProfitability();
        }

        function calculateMortgagePayment(loanAmount, annualRate, termYears) {
            const monthlyRate = annualRate / 100 / 12;
            const numPayments = termYears * 12;
            
            if (monthlyRate === 0) {
                return loanAmount / numPayments;
            }
            
            const payment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                           (Math.pow(1 + monthlyRate, numPayments) - 1);
            
            return payment;
        }

        function calculateProfitability() {
            // Track calculation
            if (typeof ym !== 'undefined') {
                ym(98765432, 'reachGoal', 'calculation_made', {
                    calculator: 'rental'
                });
            }

            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value) || 0;
            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value) || 0;
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
            const vacancyRate = parseFloat(document.getElementById('vacancyRate').value) || 0;
            const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
            const incomeTax = parseFloat(document.getElementById('incomeTax').value) || 0;
            const appreciation = parseFloat(document.getElementById('appreciation').value) || 0;

            if (propertyPrice <= 0 || monthlyRent <= 0) {
                return;
            }

            let initialInvestment = propertyPrice;
            let monthlyMortgagePayment = 0;

            if (currentPaymentType === 'mortgage') {
                const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
                const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
                const loanTerm = parseFloat(document.getElementById('loanTerm').value) || 0;
                
                const loanAmount = propertyPrice - downPayment;
                monthlyMortgagePayment = calculateMortgagePayment(loanAmount, interestRate, loanTerm);
                initialInvestment = downPayment;
            }

            const annualRent = monthlyRent * 12;
            const grossYield = (annualRent / propertyPrice) * 100;

            const vacancyLoss = monthlyRent * (vacancyRate / 100);
            const monthlyPropertyTax = propertyTax / 12;
            
            const grossMonthlyIncome = monthlyRent - vacancyLoss;
            const totalMonthlyExpenses = monthlyExpenses + monthlyPropertyTax + monthlyMortgagePayment;
            const monthlyNetIncomeBeforeTax = grossMonthlyIncome - totalMonthlyExpenses;
            const monthlyTaxAmount = monthlyNetIncomeBeforeTax * (incomeTax / 100);
            const monthlyNetIncome = monthlyNetIncomeBeforeTax - monthlyTaxAmount;
            
            const annualNetIncome = monthlyNetIncome * 12;
            const netYield = (annualNetIncome / initialInvestment) * 100;

            // –û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å —Å —É—á—ë—Ç–æ–º —Ä–æ—Å—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
            const totalReturn = netYield + appreciation;

            // –°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ —Å —É—á—ë—Ç–æ–º —Ä–æ—Å—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏: —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∏—Ä–æ—Å—Ç—É –∫–∞–ø–∏—Ç–∞–ª–∞
            // –§–æ—Ä–º—É–ª–∞: –Ω–∞—Ö–æ–¥–∏–º –≥–æ–¥, –∫–æ–≥–¥–∞ —Å—É–º–º–∞ –¥–æ—Ö–æ–¥–æ–≤ + –ø—Ä–∏—Ä–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ >= –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–º –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º
            let cumulativeReturn = 0;
            let paybackPeriod = 0;
            for (let year = 1; year <= 50; year++) {
                const yearlyRentalIncome = annualNetIncome;
                const propertyValueGrowth = initialInvestment * (Math.pow(1 + appreciation / 100, year) - 1);
                cumulativeReturn = (yearlyRentalIncome * year) + propertyValueGrowth;

                if (cumulativeReturn >= initialInvestment) {
                    paybackPeriod = year;
                    break;
                }
            }

            // –ï—Å–ª–∏ –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è –∑–∞ 50 –ª–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â—ë–Ω–Ω—É—é —Ñ–æ—Ä–º—É–ª—É
            if (paybackPeriod === 0) {
                paybackPeriod = initialInvestment / (annualNetIncome + (initialInvestment * appreciation / 100));
            }

            document.getElementById('basicNetYield').textContent = formatPercent(netYield);
            document.getElementById('grossYield').textContent = formatPercent(grossYield);
            document.getElementById('netYield').textContent = formatPercent(netYield);
            document.getElementById('monthlyNetIncome').textContent = formatNumber(monthlyNetIncome) + ' ‚ÇΩ';
            document.getElementById('paybackPeriod').textContent = paybackPeriod.toFixed(1) + ' –ª–µ—Ç';

            updateCashFlowDetails(monthlyRent, monthlyMortgagePayment, monthlyExpenses, monthlyNetIncome);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é —Ä–∞—Å—á–µ—Ç–æ–≤
            updateCalculationDetails();
        }

        function updateCashFlowDetails(rent, mortgage, expenses, netFlow) {
            document.getElementById('rentIncome').textContent = formatNumber(rent) + ' ‚ÇΩ';
            document.getElementById('mortgagePayment').textContent = '-' + formatNumber(mortgage) + ' ‚ÇΩ';
            
            const management = expenses * 0.4;
            const utilities = expenses * 0.27;
            const repair = expenses * 0.2;
            const taxes = expenses * 0.13;
            
            document.getElementById('managementCost').textContent = '-' + formatNumber(management) + ' ‚ÇΩ';
            document.getElementById('utilities').textContent = '-' + formatNumber(utilities) + ' ‚ÇΩ';
            document.getElementById('repairReserve').textContent = '-' + formatNumber(repair) + ' ‚ÇΩ';
            document.getElementById('taxes').textContent = '-' + formatNumber(taxes) + ' ‚ÇΩ';
            document.getElementById('netCashFlow').textContent = formatNumber(netFlow) + ' ‚ÇΩ';
        }

        function resetCalculator() {
            document.getElementById('propertyPrice').value = 8000000;
            document.getElementById('monthlyRent').value = 80000;
            document.getElementById('monthlyExpenses').value = 15000;
            document.getElementById('downPayment').value = 2400000;
            document.getElementById('interestRate').value = 12;
            document.getElementById('loanTerm').value = 20;
            document.getElementById('vacancyRate').value = 5;
            document.getElementById('propertyTax').value = 20000;
            document.getElementById('incomeTax').value = 13;
            document.getElementById('appreciation').value = 3;
            document.getElementById('investmentPeriod').value = 10;
            calculateProfitability();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ä–∞—Å—á–µ—Ç–æ–≤
        function toggleCalculationDetails() {
            const content = document.getElementById('calculationDetailsContent');
            const toggle = document.querySelector('.details-toggle');
            const toggleText = toggle.querySelector('.toggle-text');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                toggle.classList.remove('active');
                toggleText.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å—á–µ—Ç—ã';
            } else {
                content.classList.add('show');
                toggle.classList.add('active');
                toggleText.textContent = '–°–∫—Ä—ã—Ç—å —Ä–∞—Å—á–µ—Ç—ã';
            }
        }
        
        function updateCalculationDetails() {
            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value);
            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value);
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value);
            
            const annualRent = monthlyRent * 12;
            const grossYield = (annualRent / propertyPrice * 100);
            const netMonthlyIncome = monthlyRent - monthlyExpenses;
            const annualNetIncome = netMonthlyIncome * 12;
            const netYield = (annualNetIncome / propertyPrice * 100);
            const paybackYears = propertyPrice / annualNetIncome;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á–µ—Ç—ã –≤ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
            document.getElementById('grossYieldCalculation').textContent = 
                `(${formatNumber(monthlyRent)} √ó 12) / ${formatNumber(propertyPrice)} √ó 100% = ${grossYield.toFixed(1)}%`;
            
            document.getElementById('netYieldCalculation').textContent = 
                `((${formatNumber(monthlyRent)} - ${formatNumber(monthlyExpenses)}) √ó 12) / ${formatNumber(propertyPrice)} √ó 100% = ${netYield.toFixed(1)}%`;
            
            document.getElementById('paybackCalculation').textContent = 
                `${formatNumber(propertyPrice)} / (${formatNumber(netMonthlyIncome)} √ó 12) = ${paybackYears.toFixed(1)} –ª–µ—Ç`;
        }

        function exportToPDF() {
            // Track PDF export
            if (typeof ym !== 'undefined') {
                ym(98765432, 'reachGoal', 'pdf_export', {
                    calculator: 'rental'
                });
            }

            // Use the improved PDF export system
            exportProfitabilityToPDF();
        }

        function syncSliders() {
            const sliderInputs = ['propertyPrice', 'monthlyRent', 'monthlyExpenses'];
            
            sliderInputs.forEach(field => {
                const input = document.getElementById(field);
                const slider = document.getElementById(field + 'Slider');
                
                if (slider) {
                    input.addEventListener('input', () => {
                        slider.value = input.value;
                        debouncedCalculateProfitability();
                    });
                    
                    slider.addEventListener('input', () => {
                        input.value = slider.value;
                        debouncedCalculateProfitability();
                    });
                }
            });
        }

        // Debounced calculation functions
        let calculationTimeout = null;
        
        function debouncedCalculateProfitability() {
            clearTimeout(calculationTimeout);
            calculationTimeout = setTimeout(() => {
                calculateProfitability();
            }, 150); // Doherty Threshold compliance - under 400ms
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Debounced event listeners for better performance
            document.getElementById('propertyPrice').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('monthlyRent').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('monthlyExpenses').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('downPayment').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('interestRate').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('loanTerm').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('vacancyRate').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('propertyTax').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('incomeTax').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('appreciation').addEventListener('input', debouncedCalculateProfitability);
            document.getElementById('investmentPeriod').addEventListener('input', debouncedCalculateProfitability);

            syncSliders();
            calculateProfitability();

            // Initialize UX enhancements
            if (window.uxEnhancer) {
                // Highlight main results
                setTimeout(() => {
                    window.uxEnhancer.highlightMainResult('.result-value.primary');
                    window.uxEnhancer.groupResults(['.result-item', '.metrics-grid']);
                }, 100);
            }
        });

        function exportToExcel() {
            if (typeof ym !== 'undefined') {
                ym(98765432, 'reachGoal', 'excel_export', {
                    calculator: 'rental'
                });
            }

            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value) || 0;
            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value) || 0;
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
            const vacancyRate = parseFloat(document.getElementById('vacancyRate').value) || 0;
            const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
            const appreciation = parseFloat(document.getElementById('appreciation').value) || 0;

            const annualRent = monthlyRent * 12;
            const annualExpenses = monthlyExpenses * 12 + propertyTax;
            const vacancyLoss = annualRent * (vacancyRate / 100);
            const effectiveRent = annualRent - vacancyLoss;
            const netIncome = effectiveRent - annualExpenses;
            const grossYield = (annualRent / propertyPrice) * 100;
            const netYield = (netIncome / propertyPrice) * 100;

            let csvContent = '\uFEFF';
            csvContent += '–ú2 - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏\n';
            csvContent += `–î–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞,${new Date().toLocaleString('ru-RU')}\n\n`;
            csvContent += '–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á—ë—Ç–∞\n';
            csvContent += '–ü–∞—Ä–∞–º–µ—Ç—Ä,–ó–Ω–∞—á–µ–Ω–∏–µ\n';
            csvContent += `–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏,${formatNumber(propertyPrice)} ‚ÇΩ\n`;
            csvContent += `–ú–µ—Å—è—á–Ω–∞—è –∞—Ä–µ–Ω–¥–∞,${formatNumber(monthlyRent)} ‚ÇΩ\n`;
            csvContent += `–ú–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã,${formatNumber(monthlyExpenses)} ‚ÇΩ\n`;
            csvContent += `–ü—Ä–æ—Ü–µ–Ω—Ç –≤–∞–∫–∞–Ω—Ç–Ω–æ—Å—Ç–∏,${vacancyRate}%\n`;
            csvContent += `–ù–∞–ª–æ–≥ –Ω–∞ –∏–º—É—â–µ—Å—Ç–≤–æ,${formatNumber(propertyTax)} ‚ÇΩ/–≥–æ–¥\n`;
            csvContent += `–†–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏,${appreciation}%\n\n`;
            csvContent += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n';
            csvContent += '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å,–ó–Ω–∞—á–µ–Ω–∏–µ\n';
            csvContent += `–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥,${formatNumber(annualRent)} ‚ÇΩ\n`;
            csvContent += `–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥,${formatNumber(effectiveRent)} ‚ÇΩ\n`;
            csvContent += `–ì–æ–¥–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã,${formatNumber(annualExpenses)} ‚ÇΩ\n`;
            csvContent += `–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥,${formatNumber(netIncome)} ‚ÇΩ\n`;
            csvContent += `–í–∞–ª–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å,${grossYield.toFixed(2)}%\n`;
            csvContent += `–ß–∏—Å—Ç–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å,${netYield.toFixed(2)}%\n`;

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `m2_rental_${new Date().getTime()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('Excel —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
        }
    </script>
<script src="m2-layout.js"></script>
</body>
</html>
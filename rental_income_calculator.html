<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –æ—Ç –∞—Ä–µ–Ω–¥—ã - –ú2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.5;
            color: #333;
            background-color: #f8f9fa;
            font-size: 14px;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
        }

        .logo {
            font-size: 32px;
            font-weight: 700;
            color: #007bff;
            text-decoration: none;
        }

        .back-link {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 16px;
        }

        .page-header {
            background: white;
            border-radius: 8px;
            padding: 32px;
            margin-bottom: 24px;
            text-align: center;
            border: 1px solid #e6e6e6;
        }

        .page-title {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
        }

        .page-subtitle {
            font-size: 18px;
            color: #666;
            max-width: 700px;
            margin: 0 auto;
        }

        .calculator-layout {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .calculator-form {
            background: white;
            border-radius: 8px;
            padding: 32px;
            border: 1px solid #e6e6e6;
            height: fit-content;
        }

        .results-section {
            background: white;
            border-radius: 8px;
            padding: 32px;
            border: 1px solid #e6e6e6;
        }

        .form-section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e6e6e6;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e6e6e6;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.2s;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .input-suffix {
            position: relative;
        }

        .input-suffix::after {
            content: attr(data-suffix);
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
            font-size: 14px;
        }

        .calculate-btn {
            width: 100%;
            padding: 16px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }

        .yield-highlight {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 24px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 24px;
        }

        .yield-main {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .yield-label {
            font-size: 16px;
            opacity: 0.9;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .result-item {
            padding: 16px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }

        .result-item.positive {
            border-left-color: #28a745;
        }

        .result-item.negative {
            border-left-color: #dc3545;
        }

        .result-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .result-desc {
            font-size: 13px;
            color: #666;
        }

        .chart-container {
            height: 400px;
            margin: 24px 0;
        }

        .analysis-section {
            background: white;
            border-radius: 8px;
            padding: 32px;
            border: 1px solid #e6e6e6;
            margin-bottom: 24px;
        }

        @media (max-width: 968px) {
            .calculator-layout {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="m2-hub.html" class="logo">–ú2</a>
            <a href="m2-hub.html" class="back-link">‚Üê –ö –≤—ã–±–æ—Ä—É —Ä–∞—Å—á—ë—Ç–æ–≤</a>
        </div>
    </header>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –æ—Ç –∞—Ä–µ–Ω–¥—ã</h1>
            <p class="page-subtitle">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–ª—è —Å–¥–∞—á–∏ –≤ –∞—Ä–µ–Ω–¥—É</p>
        </div>

        <div class="calculator-layout">
            <div class="calculator-form">
                <form id="rentalIncomeForm">
                    <div class="form-section">
                        <h3 class="section-title">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è</h3>
                        
                        <div class="form-group">
                            <label class="form-label">–¶–µ–Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="purchasePrice" class="form-input" value="6000000" min="500000" step="100000" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø–æ–∫—É–ø–∫—É</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="purchaseCosts" class="form-input" value="300000" min="0" step="10000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–†–µ–º–æ–Ω—Ç –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="renovationCosts" class="form-input" value="800000" min="0" step="50000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–°–ø–æ—Å–æ–± –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è</label>
                            <select id="purchaseMethod" class="form-select">
                                <option value="cash">–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</option>
                                <option value="mortgage">–ò–ø–æ—Ç–µ–∫–∞</option>
                                <option value="mixed">–°–º–µ—à–∞–Ω–Ω–æ–µ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section" id="mortgageSection" style="display: none;">
                        <h3 class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ø–æ—Ç–µ–∫–∏</h3>
                        
                        <div class="form-group">
                            <label class="form-label">–†–∞–∑–º–µ—Ä –∫—Ä–µ–¥–∏—Ç–∞</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="loanAmount" class="form-input" value="3000000" min="0" step="100000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞</label>
                            <div class="input-suffix" data-suffix="%">
                                <input type="number" id="interestRate" class="form-input" value="10.5" min="1" max="30" step="0.1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞</label>
                            <select id="loanTerm" class="form-select">
                                <option value="10">10 –ª–µ—Ç</option>
                                <option value="15">15 –ª–µ—Ç</option>
                                <option value="20" selected>20 –ª–µ—Ç</option>
                                <option value="25">25 –ª–µ—Ç</option>
                                <option value="30">30 –ª–µ—Ç</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">–î–æ—Ö–æ–¥—ã –æ—Ç –∞—Ä–µ–Ω–¥—ã</h3>
                        
                        <div class="form-group">
                            <label class="form-label">–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∞—Ä–µ–Ω–¥–Ω–∞—è –ø–ª–∞—Ç–∞</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="monthlyRent" class="form-input" value="80000" min="10000" step="5000" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ó–∞—Å–µ–ª—ë–Ω–Ω–æ—Å—Ç—å</label>
                            <div class="input-suffix" data-suffix="%">
                                <input type="number" id="occupancyRate" class="form-input" value="95" min="70" max="100" step="1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–†–æ—Å—Ç –∞—Ä–µ–Ω–¥–Ω–æ–π –ø–ª–∞—Ç—ã</label>
                            <div class="input-suffix" data-suffix="% –≤ –≥–æ–¥">
                                <input type="number" id="rentGrowth" class="form-input" value="6" min="0" max="20" step="0.5">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</h3>
                        
                        <div class="form-group">
                            <label class="form-label">–ù–∞–ª–æ–≥ –Ω–∞ –∏–º—É—â–µ—Å—Ç–≤–æ (–≤ –≥–æ–¥)</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="propertyTax" class="form-input" value="18000" min="0" step="1000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ (–≤ –≥–æ–¥)</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="insurance" class="form-input" value="12000" min="0" step="1000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</label>
                            <div class="input-suffix" data-suffix="% –æ—Ç –∞—Ä–µ–Ω–¥—ã">
                                <input type="number" id="managementFee" class="form-input" value="8" min="0" max="30" step="1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–†–µ–º–æ–Ω—Ç –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (–≤ –≥–æ–¥)</label>
                            <div class="input-suffix" data-suffix="‚ÇΩ">
                                <input type="number" id="maintenanceCosts" class="form-input" value="50000" min="0" step="5000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ü–æ–¥–æ—Ö–æ–¥–Ω—ã–π –Ω–∞–ª–æ–≥ —Å –∞—Ä–µ–Ω–¥—ã</label>
                            <div class="input-suffix" data-suffix="%">
                                <input type="number" id="incomeTax" class="form-input" value="13" min="0" max="50" step="1">
                            </div>
                        </div>
                    </div>

                    <button type="button" class="calculate-btn" onclick="calculateRentalIncome()">
                        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
                    </button>
                </form>
            </div>

            <div class="results-section" id="resultsSection">
                <div id="resultsContent">
                    <div style="text-align: center; color: #666; padding: 40px 20px;">
                        <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Å–ª–µ–≤–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-section" id="analysisSection" style="display: none;">
            <h3 class="section-title">–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</h3>
            <div id="analysisContent"></div>
        </div>

        <div class="analysis-section" id="chartSection" style="display: none;">
            <h3 class="section-title">–ì—Ä–∞—Ñ–∏–∫ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤</h3>
            <div class="chart-container">
                <canvas id="cashFlowChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let cashFlowChart;

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è –∏–ø–æ—Ç–µ–∫–∏
        document.getElementById('purchaseMethod').addEventListener('change', function() {
            const mortgageSection = document.getElementById('mortgageSection');
            mortgageSection.style.display = this.value === 'cash' ? 'none' : 'block';
        });

        function calculateRentalIncome() {
            const params = getInputValues();
            
            if (!validateInputs(params)) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è');
                return;
            }

            const results = performCalculations(params);
            displayResults(results);
            displayAnalysis(results);
            createCashFlowChart(results);
            
            document.getElementById('analysisSection').style.display = 'block';
            document.getElementById('chartSection').style.display = 'block';
        }

        function getInputValues() {
            return {
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                purchaseCosts: parseFloat(document.getElementById('purchaseCosts').value),
                renovationCosts: parseFloat(document.getElementById('renovationCosts').value),
                purchaseMethod: document.getElementById('purchaseMethod').value,
                loanAmount: parseFloat(document.getElementById('loanAmount').value) || 0,
                interestRate: parseFloat(document.getElementById('interestRate').value) / 100 || 0,
                loanTerm: parseInt(document.getElementById('loanTerm').value) || 0,
                monthlyRent: parseFloat(document.getElementById('monthlyRent').value),
                occupancyRate: parseFloat(document.getElementById('occupancyRate').value) / 100,
                rentGrowth: parseFloat(document.getElementById('rentGrowth').value) / 100,
                propertyTax: parseFloat(document.getElementById('propertyTax').value),
                insurance: parseFloat(document.getElementById('insurance').value),
                managementFee: parseFloat(document.getElementById('managementFee').value) / 100,
                maintenanceCosts: parseFloat(document.getElementById('maintenanceCosts').value),
                incomeTax: parseFloat(document.getElementById('incomeTax').value) / 100
            };
        }

        function validateInputs(params) {
            return params.purchasePrice > 0 && params.monthlyRent > 0;
        }

        function performCalculations(params) {
            const totalInvestment = params.purchasePrice + params.purchaseCosts + params.renovationCosts;
            const ownCapital = totalInvestment - params.loanAmount;
            
            // –†–∞—Å—á—ë—Ç –∏–ø–æ—Ç–µ—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
            let monthlyMortgagePayment = 0;
            if (params.loanAmount > 0 && params.interestRate > 0) {
                const monthlyRate = params.interestRate / 12;
                const totalPayments = params.loanTerm * 12;
                monthlyMortgagePayment = params.loanAmount * 
                    (monthlyRate * Math.pow(1 + monthlyRate, totalPayments)) / 
                    (Math.pow(1 + monthlyRate, totalPayments) - 1);
            }

            // –ì–æ–¥–æ–≤—ã–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã
            const yearlyRent = params.monthlyRent * 12 * params.occupancyRate;
            const yearlyMortgagePayments = monthlyMortgagePayment * 12;
            const yearlyManagementFee = yearlyRent * params.managementFee;
            const yearlyOperatingCosts = params.propertyTax + params.insurance + params.maintenanceCosts + yearlyManagementFee;
            
            const grossIncome = yearlyRent;
            const netOperatingIncome = grossIncome - yearlyOperatingCosts;
            const beforeTaxCashFlow = netOperatingIncome - yearlyMortgagePayments;
            const taxableIncome = Math.max(0, grossIncome - yearlyOperatingCosts - (params.loanAmount > 0 ? params.loanAmount * params.interestRate : 0));
            const taxes = taxableIncome * params.incomeTax;
            const afterTaxCashFlow = beforeTaxCashFlow - taxes;

            // –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
            const grossYield = (grossIncome / totalInvestment) * 100;
            const netYield = (netOperatingIncome / totalInvestment) * 100;
            const cashOnCashReturn = ownCapital > 0 ? (afterTaxCashFlow / ownCapital) * 100 : 0;
            const capRate = (netOperatingIncome / params.purchasePrice) * 100;

            // –°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏
            const paybackPeriod = ownCapital > 0 ? ownCapital / Math.max(afterTaxCashFlow, 1) : 0;

            return {
                params,
                totalInvestment,
                ownCapital,
                monthlyMortgagePayment,
                grossIncome,
                netOperatingIncome,
                beforeTaxCashFlow,
                afterTaxCashFlow,
                taxes,
                grossYield,
                netYield,
                cashOnCashReturn,
                capRate,
                paybackPeriod,
                yearlyOperatingCosts,
                monthlyNetCashFlow: afterTaxCashFlow / 12
            };
        }

        function displayResults(results) {
            const isPositive = results.afterTaxCashFlow > 0;
            
            const resultsHTML = `
                <div class="yield-highlight">
                    <div class="yield-main">${results.cashOnCashReturn.toFixed(2)}%</div>
                    <div class="yield-label">–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª</div>
                </div>

                <div class="results-grid">
                    <div class="result-item ${isPositive ? 'positive' : 'negative'}">
                        <div class="result-value">${formatCurrency(results.afterTaxCashFlow)}</div>
                        <div class="result-desc">–ß–∏—Å—Ç—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫ –≤ –≥–æ–¥</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${formatCurrency(results.monthlyNetCashFlow)}</div>
                        <div class="result-desc">–ß–∏—Å—Ç—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫ –≤ –º–µ—Å—è—Ü</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${results.grossYield.toFixed(2)}%</div>
                        <div class="result-desc">–í–∞–ª–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${results.netYield.toFixed(2)}%</div>
                        <div class="result-desc">–ß–∏—Å—Ç–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${results.capRate.toFixed(2)}%</div>
                        <div class="result-desc">–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${results.paybackPeriod.toFixed(1)} –ª–µ—Ç</div>
                        <div class="result-desc">–°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏</div>
                    </div>
                </div>
            `;

            document.getElementById('resultsContent').innerHTML = resultsHTML;
        }

        function displayAnalysis(results) {
            const operatingExpenseRatio = (results.yearlyOperatingCosts / results.grossIncome * 100).toFixed(1);
            
            const analysisHTML = `
                <div class="results-grid">
                    <div class="result-item">
                        <div class="result-value">${formatCurrency(results.totalInvestment)}</div>
                        <div class="result-desc">–û–±—â–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${formatCurrency(results.ownCapital)}</div>
                        <div class="result-desc">–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${formatCurrency(results.grossIncome)}</div>
                        <div class="result-desc">–í–∞–ª–æ–≤—ã–π –¥–æ—Ö–æ–¥ –≤ –≥–æ–¥</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${formatCurrency(results.yearlyOperatingCosts)}</div>
                        <div class="result-desc">–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –≤ –≥–æ–¥</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${formatCurrency(results.netOperatingIncome)}</div>
                        <div class="result-desc">–ß–∏—Å—Ç—ã–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –¥–æ—Ö–æ–¥</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value">${operatingExpenseRatio}%</div>
                        <div class="result-desc">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤</div>
                    </div>
                </div>

                <div style="margin-top: 24px; padding: 20px; background: ${results.cashOnCashReturn >= 8 ? '#d4edda' : results.cashOnCashReturn >= 5 ? '#fff3cd' : '#f8d7da'}; border-radius: 6px;">
                    <h4 style="margin-bottom: 12px;">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</h4>
                    <p>${getInvestmentRecommendation(results)}</p>
                </div>

                ${results.params.loanAmount > 0 ? `
                <div style="margin-top: 16px; padding: 16px; background: #f8f9fa; border-radius: 6px;">
                    <h4 style="margin-bottom: 8px;">–ò–ø–æ—Ç–µ—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</h4>
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-value">${formatCurrency(results.monthlyMortgagePayment)}</div>
                            <div class="result-desc">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂</div>
                        </div>
                        <div class="result-item">
                            <div class="result-value">${((results.params.loanAmount / results.totalInvestment) * 100).toFixed(1)}%</div>
                            <div class="result-desc">–î–æ–ª—è –∑–∞—ë–º–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤</div>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;

            document.getElementById('analysisContent').innerHTML = analysisHTML;
        }

        function getInvestmentRecommendation(results) {
            const cashReturn = results.cashOnCashReturn;
            
            if (cashReturn >= 12) {
                return "üü¢ –û—Ç–ª–∏—á–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è! –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è.";
            } else if (cashReturn >= 8) {
                return "üü° –•–æ—Ä–æ—à–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è. –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –≤—ã—à–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –∏ –º–Ω–æ–≥–∏—Ö –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.";
            } else if (cashReturn >= 5) {
                return "üü† –£–º–µ—Ä–µ–Ω–Ω–∞—è –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º–∏ –≤–ª–æ–∂–µ–Ω–∏—è–º–∏ —Å —É—á—ë—Ç–æ–º —Ä–∏—Å–∫–æ–≤.";
            } else if (cashReturn > 0) {
                return "üî¥ –ù–∏–∑–∫–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π –∏–ª–∏ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.";
            } else {
                return "‚ùå –£–±—ã—Ç–æ—á–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–º–æ—Ç—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–ª–∏ –æ—Ç–∫–∞–∑ –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞.";
            }
        }

        function createCashFlowChart(results) {
            const ctx = document.getElementById('cashFlowChart').getContext('2d');
            
            if (cashFlowChart) {
                cashFlowChart.destroy();
            }

            const years = [];
            const cashFlows = [];
            const cumulativeFlows = [];
            let cumulative = -results.ownCapital; // –ù–∞—á–∞–ª—å–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏

            for (let year = 1; year <= 10; year++) {
                const yearlyFlow = results.afterTaxCashFlow * Math.pow(1 + results.params.rentGrowth, year - 1);
                cumulative += yearlyFlow;
                
                years.push(`–ì–æ–¥ ${year}`);
                cashFlows.push(yearlyFlow);
                cumulativeFlows.push(cumulative);
            }

            cashFlowChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: '–ì–æ–¥–æ–≤–æ–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫',
                            data: cashFlows,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            yAxisID: 'y'
                        },
                        {
                            label: '–ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫',
                            data: cumulativeFlows,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '–ü—Ä–æ–≥–Ω–æ–∑ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            calculateRentalIncome();
        });
    </script>
</body>
</html>
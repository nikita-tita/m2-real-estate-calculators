<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç M2 Calculator Enhancements</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 30px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .status-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .status-value {
            font-size: 14px;
            color: #666;
            word-break: break-all;
        }

        .test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .test-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .test-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
        }

        .success {
            color: #28a745;
        }

        .error {
            color: #dc3545;
        }

        .warning {
            color: #ffc107;
        }

        .info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç M2 Calculator Enhancements v1.1</h1>

        <div class="status-grid" id="statusGrid">
            <div class="status-card">
                <div class="status-title">üöÄ –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</div>
                <div class="status-value" id="systemLoaded">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</div>
            </div>

            <div class="status-card">
                <div class="status-title">üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –º–æ–¥—É–ª–µ–π</div>
                <div class="status-value" id="modulesLoaded">0 / 17</div>
                <div style="font-size: 10px; margin-top: 5px; color: #666;" id="modulesList">–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...</div>
            </div>

            <div class="status-card">
                <div class="status-title">üîß API —Å—Ç–∞—Ç—É—Å</div>
                <div class="status-value" id="apiStatus">–ù–µ –≥–æ—Ç–æ–≤</div>
                <div style="font-size: 10px; margin-top: 5px; color: #666;" id="apiDetails">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
            </div>

            <div class="status-card">
                <div class="status-title">üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</div>
                <div class="status-value" id="deviceInfo">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</div>
                <div style="font-size: 10px; margin-top: 5px; color: #666;" id="deviceDetails">–ê–Ω–∞–ª–∏–∑...</div>
            </div>

            <div class="status-card">
                <div class="status-title">ü§ñ AI –ü–æ–º–æ—â–Ω–∏–∫</div>
                <div class="status-value" id="aiStatus">–ù–µ –≥–æ—Ç–æ–≤</div>
                <div style="font-size: 10px; margin-top: 5px; color: #666;" id="aiDetails">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏...</div>
            </div>

            <div class="status-card">
                <div class="status-title">üìä PDF –≠–∫—Å–ø–æ—Ä—Ç</div>
                <div class="status-value" id="pdfStatus">–ù–µ –≥–æ—Ç–æ–≤</div>
                <div style="font-size: 10px; margin-top: 5px; color: #666;" id="pdfDetails">–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏...</div>
            </div>

            <div class="status-card">
                <div class="status-title">üé® –¢–µ–º—ã</div>
                <div class="status-value" id="themeStatus">–ù–µ –≥–æ—Ç–æ–≤</div>
                <div style="font-size: 10px; margin-top: 5px; color: #666;" id="themeDetails">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
            </div>

            <div class="status-card">
                <div class="status-title">üì± PWA</div>
                <div class="status-value" id="pwaStatus">–ù–µ –≥–æ—Ç–æ–≤</div>
                <div style="font-size: 10px; margin-top: 5px; color: #666;" id="pwaDetails">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏...</div>
            </div>
        </div>

        <div class="test-buttons">
            <button class="test-btn" onclick="testAPI()">üîß –¢–µ—Å—Ç API</button>
            <button class="test-btn" onclick="testAI()">ü§ñ –¢–µ—Å—Ç AI</button>
            <button class="test-btn" onclick="testPWA()">üì± –¢–µ—Å—Ç PWA</button>
            <button class="test-btn" onclick="testThemes()">üé® –¢–µ—Å—Ç —Ç–µ–º</button>
            <button class="test-btn" onclick="testAnalytics()">üìä –¢–µ—Å—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</button>
            <button class="test-btn" onclick="testTemplates()">üìã –¢–µ—Å—Ç —à–∞–±–ª–æ–Ω–æ–≤</button>
            <button class="test-btn" onclick="testVisitorCounter()">üë• –¢–µ—Å—Ç —Å—á–µ—Ç—á–∏–∫–∞</button>
            <button class="test-btn" onclick="showDashboard()">üìà –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞—à–±–æ—Ä–¥</button>
            <button class="test-btn" onclick="testPDFExport()">üìÑ –¢–µ—Å—Ç PDF</button>
            <button class="test-btn" onclick="exportData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
        </div>

        <div style="margin: 30px 0;">
            <h3 style="color: #007bff; margin-bottom: 15px;">üßÆ –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã:</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="openCalculator('mortgage_calculator.html')">üè† –ò–ø–æ—Ç–µ–∫–∞</button>
                <button class="test-btn" onclick="openCalculator('rental_profitability_calculator.html')">üí∞ –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</button>
                <button class="test-btn" onclick="openCalculator('affordability_calculator.html')">üí≥ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</button>
                <button class="test-btn" onclick="openCalculator('rent_vs_buy_calculator.html')">‚öñÔ∏è –ê—Ä–µ–Ω–¥–∞ vs –ü–æ–∫—É–ø–∫–∞</button>
                <button class="test-btn" onclick="openCalculator('airbnb_calculator.html')">üè® Airbnb</button>
                <button class="test-btn" onclick="openCalculator('new_vs_secondary_calculator.html')">üÜö –ù–æ–≤–æ–µ vs –í—Ç–æ—Ä–∏—á–∫–∞</button>
                <button class="test-btn" onclick="openCalculator('advanced_compound_calculator.html')">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</button>
                <button class="test-btn" onclick="openCalculator('compound_interest_calculator.html')">üßÆ –ü—Ä–æ—Ü–µ–Ω—Ç—ã</button>
                <button class="test-btn" onclick="openCalculator('prepayment_calculator.html')">‚è∞ –î–æ—Å—Ä–æ—á–∫–∞</button>
            </div>
        </div>

        <div class="log" id="testLog">
            <div class="info">üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º jsPDF –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è PDF —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∏—Å—Ç–µ–º—É —É–ª—É—á—à–µ–Ω–∏–π -->
    <script src="m2-enhancements-loader.js"></script>

    <script>
        let testLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push({ timestamp, message, type });

            const logElement = document.getElementById('testLog');
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);

            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–∏—Å—Ç–µ–º—ã
            const systemLoaded = !!window.M2EnhancementsLoader;
            document.getElementById('systemLoaded').textContent = systemLoaded ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç';
            document.getElementById('systemLoaded').className = systemLoaded ? 'success' : 'error';

            // –°—á–∏—Ç–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
            const moduleCount = Object.keys(window).filter(key => key.startsWith('M2')).length;
            const modules = Object.keys(window).filter(key => key.startsWith('M2'));
            document.getElementById('modulesLoaded').textContent = `${moduleCount} / 17`;
            document.getElementById('modulesList').textContent = modules.length > 0 ? modules.join(', ') : '–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º API
            const apiReady = !!window.M2API;
            document.getElementById('apiStatus').textContent = apiReady ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚ùå –ù–µ –≥–æ—Ç–æ–≤';
            document.getElementById('apiDetails').textContent = apiReady ? '–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã' : '–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ M2API';

            // AI –ü–æ–º–æ—â–Ω–∏–∫
            const aiReady = !!window.M2AI;
            document.getElementById('aiStatus').textContent = aiReady ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚ùå –ù–µ –≥–æ—Ç–æ–≤';
            document.getElementById('aiDetails').textContent = aiReady ? '–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ' : '–ó–∞–≥—Ä—É–∑–∫–∞ AI –º–æ–¥—É–ª—è...';

            // PDF –≠–∫—Å–ø–æ—Ä—Ç
            const pdfReady = typeof window.jspdf !== 'undefined' || typeof window.jsPDF !== 'undefined';
            document.getElementById('pdfStatus').textContent = pdfReady ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚ùå –ù–µ –≥–æ—Ç–æ–≤';
            document.getElementById('pdfDetails').textContent = pdfReady ? 'jsPDF –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞' : '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ jsPDF';

            // –¢–µ–º—ã
            const themeReady = !!window.M2DarkTheme;
            document.getElementById('themeStatus').textContent = themeReady ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚ùå –ù–µ –≥–æ—Ç–æ–≤';
            document.getElementById('themeDetails').textContent = themeReady ?
                `–¢–µ–∫—É—â–∞—è —Ç–µ–º–∞: ${window.M2DarkTheme.getCurrentTheme()}` : '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ç–µ–º...';

            // PWA
            const pwaReady = !!window.M2PWA;
            document.getElementById('pwaStatus').textContent = pwaReady ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚ùå –ù–µ –≥–æ—Ç–æ–≤';
            if (pwaReady) {
                const pwaStatus = window.M2PWA.getPWAStatus();
                document.getElementById('pwaDetails').textContent =
                    `–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${pwaStatus.isInstalled ? '–î–∞' : '–ù–µ—Ç'}, –û–Ω–ª–∞–π–Ω: ${pwaStatus.isOnline ? '–î–∞' : '–ù–µ—Ç'}`;
            } else {
                document.getElementById('pwaDetails').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ PWA –º–æ–¥—É–ª—è...';
            }

            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            if (window.M2MobileOptimizer) {
                const deviceInfo = window.M2MobileOptimizer.getDeviceInfo();
                document.getElementById('deviceInfo').textContent =
                    `${deviceInfo.isMobile ? 'üì± –ú–æ–±–∏–ª—å–Ω–æ–µ' : 'üíª –î–µ—Å–∫—Ç–æ–ø'} —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ`;
                document.getElementById('deviceDetails').textContent =
                    `–≠–∫—Ä–∞–Ω: ${deviceInfo.screenWidth}x${deviceInfo.screenHeight}, Touch: ${deviceInfo.touchSupport ? '–î–∞' : '–ù–µ—Ç'}`;
            } else {
                document.getElementById('deviceDetails').textContent = '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤...';
            }

            log(`–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ${moduleCount} –º–æ–¥—É–ª–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω–æ`, 'info');
        }

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function testAPI() {
            log('üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...', 'info');

            if (!window.M2API) {
                log('‚ùå M2API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            try {
                // –¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ –∏–ø–æ—Ç–µ–∫–∏
                const result = await window.M2API.calculate('mortgage', {
                    propertyPrice: 5000000,
                    downPayment: 1000000,
                    interestRate: 8.5,
                    loanTerm: 20
                });

                if (result.success) {
                    log(`‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç: –ü–ª–∞—Ç–µ–∂ = ${result.data.monthlyPayment.toLocaleString()} —Ä—É–±`, 'success');
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ API: ${result.error}`, 'error');
                }

                // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                const validation = await window.M2API.validateParameters('mortgage', {
                    propertyPrice: 5000000
                });

                log(`üîç –í–∞–ª–∏–¥–∞—Ü–∏—è: ${validation.valid ? '–ü—Ä–æ—à–ª–∞' : '–ù–µ –ø—Ä–æ—à–ª–∞'}`, validation.valid ? 'success' : 'warning');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API: ${error.message}`, 'error');
            }
        }

        function testAI() {
            log('ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –ø–æ–º–æ—â–Ω–∏–∫–∞...', 'info');

            if (!window.M2AI) {
                log('‚ùå M2AI –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            try {
                window.M2AI.toggle();
                log('‚úÖ AI –ø–æ–º–æ—â–Ω–∏–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', 'success');

                setTimeout(() => {
                    window.M2AI.askQuestion('–ö–∞–∫–æ–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å?');
                    log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω AI', 'success');
                }, 1000);

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è AI: ${error.message}`, 'error');
            }
        }

        function testPWA() {
            log('üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PWA...', 'info');

            if (!window.M2PWA) {
                log('‚ùå M2PWA –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            try {
                const status = window.M2PWA.getPWAStatus();
                log(`üì± PWA —Å—Ç–∞—Ç—É—Å: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ=${status.isInstalled}, –î–æ—Å—Ç—É–ø–Ω–æ=${status.isInstallable}`, 'info');
                log(`üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ${status.isOnline ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω'}`, status.isOnline ? 'success' : 'warning');
                log(`‚öôÔ∏è Service Worker: ${status.serviceWorkerRegistered ? '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω' : '–ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'}`, 'info');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è PWA: ${error.message}`, 'error');
            }
        }

        function testThemes() {
            log('üé® –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º...', 'info');

            if (!window.M2DarkTheme) {
                log('‚ùå M2DarkTheme –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            try {
                const currentTheme = window.M2DarkTheme.getCurrentTheme();
                log(`üé® –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞: ${currentTheme}`, 'info');

                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–º—É –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                window.M2DarkTheme.toggleTheme();
                log('‚úÖ –¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞', 'success');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–º: ${error.message}`, 'error');
            }
        }

        function testAnalytics() {
            log('üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...', 'info');

            if (!window.M2Analytics) {
                log('‚ùå M2Analytics –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            try {
                const metrics = window.M2Analytics.getMetrics();
                log(`üìä –°–µ—Å—Å–∏—è: ${Math.round(metrics.sessionDuration / 1000)}—Å, –°–æ–±—ã—Ç–∏—è: ${window.M2Analytics.events.length}`, 'info');
                log(`üßÆ –†–∞—Å—á–µ—Ç—ã: ${metrics.calculations}, –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è: ${metrics.interactions}`, 'info');
                log(`üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: ${metrics.featuresUsed.join(', ')}`, 'success');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: ${error.message}`, 'error');
            }
        }

        function testTemplates() {
            log('üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤...', 'info');

            if (!window.M2Templates) {
                log('‚ùå M2Templates –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            try {
                const templates = window.M2Templates.getTemplates();
                log(`üìã –î–æ—Å—Ç—É–ø–Ω–æ —à–∞–±–ª–æ–Ω–æ–≤: ${templates.length}`, 'info');

                if (templates.length > 0) {
                    log(`üìã –ü—Ä–∏–º–µ—Ä—ã: ${templates.slice(0, 3).map(t => t.name).join(', ')}`, 'success');
                }

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤: ${error.message}`, 'error');
            }
        }

        function testVisitorCounter() {
            log('üë• –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π...', 'info');

            if (!window.M2VisitorCounter) {
                log('‚ùå M2VisitorCounter –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            try {
                const stats = window.M2VisitorCounter.getVisitorStats();
                log(`üë• –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π: ${stats.global.totalUniqueVisitors}`, 'success');
                log(`üìÖ –°–µ–≥–æ–¥–Ω—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π: ${stats.global.todayVisitors}`, 'info');
                log(`üî¢ ID –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è: ${stats.visitor.id}`, 'info');
                log(`üÜï –ù–æ–≤—ã–π –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å: ${stats.visitor.isNewVisitor ? '–î–∞' : '–ù–µ—Ç'}`, 'info');
                log(`üîÑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤: ${stats.visitor.visitCount}`, 'info');

                if (stats.visitor.calculatorsUsed.length > 0) {
                    log(`üßÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã: ${stats.visitor.calculatorsUsed.join(', ')}`, 'success');
                } else {
                    log('üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å', 'info');
                }

                // –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–¥—ã
                const trends = window.M2VisitorCounter.getVisitorTrends();
                if (trends) {
                    const last7Days = trends.last7Days.reduce((sum, day) => sum + day.visitors, 0);
                    log(`üìä –ü–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π: ${last7Days}`, 'info');
                }

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
                window.M2VisitorCounter.addUsedFeature('visitor-counter-test');
                log('‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ', 'success');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞: ${error.message}`, 'error');
                console.error('Visitor Counter Test Error:', error);
            }
        }

        function showDashboard() {
            log('üìà –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ –º–µ—Ç—Ä–∏–∫...', 'info');

            if (!window.M2MetricsDashboard) {
                log('‚ùå M2MetricsDashboard –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                log('üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å Ctrl+Alt+D', 'info');
                return;
            }

            try {
                window.M2MetricsDashboard.show();
                log('‚úÖ –î–∞—à–±–æ—Ä–¥ –º–µ—Ç—Ä–∏–∫ –æ—Ç–∫—Ä—ã—Ç', 'success');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∞—à–±–æ—Ä–¥–∞: ${error.message}`, 'error');
            }
        }

        function testPDFExport() {
            log('üìÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PDF —ç–∫—Å–ø–æ—Ä—Ç–∞...', 'info');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å jsPDF
            const jsPDFAvailable = typeof window.jspdf !== 'undefined' || typeof window.jsPDF !== 'undefined';

            if (!jsPDFAvailable) {
                log('‚ùå jsPDF –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                log('üîÑ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ jsPDF...', 'info');

                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = () => {
                    log('‚úÖ jsPDF –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    setTimeout(() => testPDFExport(), 1000);
                };
                script.onerror = () => {
                    log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å jsPDF', 'error');
                };
                document.head.appendChild(script);
                return;
            }

            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π PDF
                let jsPDF;
                if (window.jspdf && window.jspdf.jsPDF) {
                    jsPDF = window.jspdf.jsPDF;
                } else if (window.jsPDF) {
                    jsPDF = window.jsPDF;
                }

                const doc = new jsPDF();
                doc.setFont('Arial', 'normal');
                doc.setFontSize(16);
                doc.text('M2 Calculator Test Report', 20, 20);
                doc.setFontSize(12);
                doc.text('–¢–µ—Å—Ç PDF —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ!', 20, 40);
                doc.text(`–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date().toLocaleString('ru-RU')}`, 20, 55);

                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ
                const modules = Object.keys(window).filter(key => key.startsWith('M2'));
                doc.text(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –º–æ–¥—É–ª–µ–π: ${modules.length}/17`, 20, 70);
                doc.text('–ú–æ–¥—É–ª–∏: ' + modules.join(', '), 20, 85);

                doc.save('m2-pdf-test.pdf');
                log('‚úÖ PDF —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω! –§–∞–π–ª —Å–∫–∞—á–∞–Ω.', 'success');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ PDF —Ç–µ—Å—Ç–∞: ${error.message}`, 'error');
                console.error('PDF Test Error:', error);
            }
        }

        function openCalculator(calculatorFile) {
            log(`üßÆ –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞: ${calculatorFile}`, 'info');
            window.open(calculatorFile, '_blank');
        }

        async function exportData() {
            log('üíæ –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...', 'info');

            try {
                const exportData = {
                    timestamp: new Date().toISOString(),
                    testResults: testLog,
                    systemStatus: {
                        modulesLoaded: Object.keys(window).filter(key => key.startsWith('M2')),
                        analytics: window.M2Analytics?.getMetrics(),
                        device: window.M2MobileOptimizer?.getDeviceInfo(),
                        pwa: window.M2PWA?.getPWAStatus(),
                        monitoring: window.M2Monitoring?.getMonitoringStatus()
                    }
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `m2-test-results-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                log('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Å—Ç–µ–º—É...', 'info');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(updateStatus, 2000);

            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            setTimeout(updateStatus, 1000);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                log('üîÑ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤...', 'info');
                testAPI();
                setTimeout(() => testAnalytics(), 1000);
                setTimeout(() => testTemplates(), 2000);
            }, 5000);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π
        document.addEventListener('moduleLoaded', (event) => {
            log(`üì¶ –ú–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω: ${event.detail.name}`, 'success');
            updateStatus();
        });

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey && event.altKey) {
                switch (event.key) {
                    case 't':
                        event.preventDefault();
                        testAPI();
                        break;
                    case 'a':
                        event.preventDefault();
                        testAI();
                        break;
                    case 'p':
                        event.preventDefault();
                        testPWA();
                        break;
                }
            }
        });

        log('üéØ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
        log('‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: Ctrl+Alt+T (API), Ctrl+Alt+A (AI), Ctrl+Alt+P (PWA)', 'info');
    </script>
</body>
</html>